// –¢–µ—Å—Ç—ã –¥–ª—è 3 –æ—Å–æ–±—ã—Ö —Ç–∏–ø–æ–≤ –º–µ—Ç–∞–ª–ª–∞
const { calculateMetal } = require('./dist/calculator.bundle.js');
const db = require('./database/metals.json');

console.log('\nüß™ –¢–ï–°–¢–´ –î–õ–Ø –û–°–û–ë–´–• –¢–ò–ü–û–í –ú–ï–¢–ê–õ–õ–ê\n');
console.log('='.repeat(70));

let passedTests = 0;
let totalTests = 0;

function runTest(testName, params, expectedWeight, tolerance = 0.001) {
  totalTests++;
  console.log(`\nüìù –¢–ï–°–¢ ${totalTests}: ${testName}`);
  console.log('   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:', JSON.stringify(params, null, 2).replace(/\n/g, '\n   '));

  const result = calculateMetal(params, db);

  if (!result.success) {
    console.log(`   ‚ùå –û–®–ò–ë–ö–ê: ${result.error}`);
    return false;
  }

  const actualWeight = result.actual?.weight;
  const diff = Math.abs(expectedWeight - actualWeight);

  console.log(`   –û–∂–∏–¥–∞–µ–º—ã–π –≤–µ—Å: ${expectedWeight.toFixed(4)} —Ç`);
  console.log(`   –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å: ${actualWeight.toFixed(4)} —Ç`);
  console.log(`   –†–∞–∑–Ω–∏—Ü–∞: ${diff.toFixed(6)} —Ç`);

  if (diff < tolerance) {
    console.log(`   ‚úÖ –ü–†–û–ô–î–ï–ù`);
    passedTests++;
    return true;
  } else {
    console.log(`   ‚ùå –ù–ï –ü–†–û–ô–î–ï–ù (—Ä–∞–∑–Ω–∏—Ü–∞ > ${tolerance})`);
    return false;
  }
}

// ============================================================================
// –¢–ï–°–¢ 1: –õ–ò–°–¢ –ü–í
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('1Ô∏è‚É£  –õ–ò–°–¢ –ü–í (sheet_pv)');
console.log('='.repeat(70));

// –ü—Ä–∏–º–µ—Ä –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
// –õ–∏—Å—Ç –ü–í 404, –¥–ª–∏–Ω–∞ 10 –º: 1.0140127388535 √ó 10 √ó 7.85 / 1000 = 0.0796 —Ç

runTest(
  '–õ–∏—Å—Ç –ü–í 404, 10–º',
  {
    metalType: 'sheet_pv',
    size: '404',
    length: 10
  },
  0.0796
);

// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç —Å –¥—Ä—É–≥–∏–º —Ä–∞–∑–º–µ—Ä–æ–º
runTest(
  '–õ–∏—Å—Ç –ü–í 406, 5–º',
  {
    metalType: 'sheet_pv',
    size: '406',
    length: 5
  },
  2 * 5 * 7.85 / 1000  // 2 √ó 5 √ó 7.85 / 1000 = 0.0785 —Ç
);

// –¢–µ—Å—Ç —Å –≤—ã–±–æ—Ä–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞
runTest(
  '–õ–∏—Å—Ç –ü–í 606, –ì–û–°–¢ 8706-78, 8–º',
  {
    metalType: 'sheet_pv',
    size: '606',
    standard: '–ì–û–°–¢ 8706-78',
    length: 8
  },
  2.203821656051 * 8 * 7.85 / 1000
);

// ============================================================================
// –¢–ï–°–¢ 2: –õ–ò–°–¢ –ü–í –û–¶–ò–ù–ö.
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('2Ô∏è‚É£  –õ–ò–°–¢ –ü–í –û–¶–ò–ù–ö. (sheet_pv_galv)');
console.log('='.repeat(70));

// –ü—Ä–∏–º–µ—Ä –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
// –õ–∏—Å—Ç –ü–í 404, –æ—Ü–∏–Ω–∫. 3%, –¥–ª–∏–Ω–∞ 10 –º: 1.014 √ó (1 + 3/100) √ó 10 √ó 7.85 / 1000 = 0.082 —Ç

// –ù–æ –≤–Ω–∏–º–∞–Ω–∏–µ! –û—Ü–∏–Ω–∫–æ–≤–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö —É–∫–∞–∑–∞–Ω–∞ –∫–∞–∫ –¥–æ–ª–∏ (0.036 –¥–ª—è "36 –≥/–º¬≤")
// –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–ª–∏–∂–∞–π—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç "36 –≥/–º¬≤ –≠–¶ 50/50" = 0.036

runTest(
  '–õ–∏—Å—Ç –ü–í –æ—Ü–∏–Ω–∫. 404, 36 –≥/–º¬≤, 10–º',
  {
    metalType: 'sheet_pv_galv',
    size: '404',
    zincOption: '36 –≥/–º¬≤ –≠–¶ 50/50',
    length: 10
  },
  1.0140127388535 * (1 + 0.036) * 10 * 7.85 / 1000  // ‚âà 0.0824 —Ç
);

// –¢–µ—Å—Ç –±–µ–∑ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –õ–∏—Å—Ç –ü–í)
runTest(
  '–õ–∏—Å—Ç –ü–í –æ—Ü–∏–Ω–∫. 404, –±–µ–∑ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏, 10–º',
  {
    metalType: 'sheet_pv_galv',
    size: '404',
    zincOption: '–Ω–µ—Ç',
    length: 10
  },
  0.0796
);

// –¢–µ—Å—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ—Ü–∏–Ω–∫–æ–≤–∫–æ–π
runTest(
  '–õ–∏—Å—Ç –ü–í –æ—Ü–∏–Ω–∫. 506, 600 –≥/–º¬≤, 5–º',
  {
    metalType: 'sheet_pv_galv',
    size: '506',
    zincOption: '600 –≥/–º¬≤',
    length: 5
  },
  2.089171974522 * (1 + 0.6) * 5 * 7.85 / 1000
);

// ============================================================================
// –¢–ï–°–¢ 3: –õ–ò–°–¢ –†–ò–§–õ–ï–ù–´–ô
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('3Ô∏è‚É£  –õ–ò–°–¢ –†–ò–§–õ–ï–ù–´–ô (sheet_checkered)');
console.log('='.repeat(70));

// –í–Ω–∏–º–∞–Ω–∏–µ! –í –ø—Ä–∏–º–µ—Ä–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç
// –ü—Ä–∏–º–µ—Ä: –õ–∏—Å—Ç 2.5–º–º, —Ä–∏—Ñ–ª–µ–Ω–∏–µ —á–µ—á–µ–≤–∏—Ü–∞, –ø–ª–æ—â–∞–¥—å 10 –º¬≤: 3.312... √ó 10 √ó 20.1 / 1000 = 0.6657 —Ç
// –ù–æ –≤ –¥–∞–Ω–Ω—ã—Ö weights["2.5"] = 1, –∞ –Ω–µ 3.312
// –ü–æ—ç—Ç–æ–º—É –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: 1 √ó 10 √ó 20.1 / 1000 = 0.201 —Ç

runTest(
  '–õ–∏—Å—Ç —Ä–∏—Ñ–ª–µ–Ω—ã–π 2.5–º–º, —á–µ—á–µ–≤–∏—Ü–∞, 10–º¬≤',
  {
    metalType: 'sheet_checkered',
    size: '2.5',
    riffleType: '—á–µ—á–µ–≤–∏—Ü–∞',
    area: 10  // –∏—Å–ø–æ–ª—å–∑—É–µ–º area –≤–º–µ—Å—Ç–æ length!
  },
  1 * 10 * 20.1 / 1000  // = 0.201 —Ç
);

// –¢–µ—Å—Ç —Å —Ç–∏–ø–æ–º —Ä–∏—Ñ–ª–µ–Ω–∏—è "—Ä–æ–º–±"
runTest(
  '–õ–∏—Å—Ç —Ä–∏—Ñ–ª–µ–Ω—ã–π 3–º–º, —Ä–æ–º–±, 15–º¬≤',
  {
    metalType: 'sheet_checkered',
    size: '3',
    riffleType: '—Ä–æ–º–±',
    area: 15
  },
  1 * 15 * 21 / 1000  // = 0.315 —Ç
);

// –¢–µ—Å—Ç —Å –¥—Ä—É–≥–∏–º —Ä–∞–∑–º–µ—Ä–æ–º
runTest(
  '–õ–∏—Å—Ç —Ä–∏—Ñ–ª–µ–Ω—ã–π 5–º–º, —á–µ—á–µ–≤–∏—Ü–∞, 8–º¬≤',
  {
    metalType: 'sheet_checkered',
    size: '5',
    riffleType: '—á–µ—á–µ–≤–∏—Ü–∞',
    area: 8
  },
  1 * 8 * 20.1 / 1000  // = 0.1608 —Ç
);

// ============================================================================
// –ò–¢–û–ì–ò
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('\nüìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:\n');
console.log(`   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${totalTests}`);
console.log(`   –ü—Ä–æ–π–¥–µ–Ω–æ: ${passedTests} ‚úÖ`);
console.log(`   –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: ${totalTests - passedTests} ‚ùå`);

const percentage = (passedTests / totalTests * 100).toFixed(0);
console.log(`\n   –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ${percentage}%`);

if (passedTests === totalTests) {
  console.log('\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! –ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ!\n');
  console.log('='.repeat(70));
  process.exit(0);
} else {
  console.log('\n‚ùå –ï–°–¢–¨ –ü–†–û–í–ê–õ–ò–í–®–ò–ï–°–Ø –¢–ï–°–¢–´! –¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï!\n');
  console.log('='.repeat(70));
  process.exit(1);
}
