// –¢–µ—Å—Ç –¥–ª—è –ø–æ–ª–µ–π –®–∏—Ä–∏–Ω–∞ √ó –î–ª–∏–Ω–∞
const { calculateMetal } = require('./dist/calculator.bundle.js');
const db = require('./database/metals.json');

console.log('\nüìê –¢–ï–°–¢–´ –î–õ–Ø –ü–û–õ–ï–ô –®–ò–†–ò–ù–ê √ó –î–õ–ò–ù–ê\n');
console.log('='.repeat(70));

let passedTests = 0;
let totalTests = 0;

function runTest(testName, params, expectedWeight, tolerance = 0.001) {
  totalTests++;
  console.log(`\nüìù –¢–ï–°–¢ ${totalTests}: ${testName}`);
  console.log('   –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:', JSON.stringify(params, null, 2).replace(/\n/g, '\n   '));

  const result = calculateMetal(params, db);

  if (!result.success) {
    console.log(`   ‚ùå –û–®–ò–ë–ö–ê: ${result.error}`);
    return false;
  }

  const actualWeight = result.actual?.weight;
  const diff = Math.abs(expectedWeight - actualWeight);

  console.log(`   –û–∂–∏–¥–∞–µ–º—ã–π –≤–µ—Å: ${expectedWeight.toFixed(4)} —Ç`);
  console.log(`   –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—Å: ${actualWeight.toFixed(4)} —Ç`);
  console.log(`   –†–∞–∑–Ω–∏—Ü–∞: ${diff.toFixed(6)} —Ç`);

  if (diff < tolerance) {
    console.log(`   ‚úÖ –ü–†–û–ô–î–ï–ù`);
    passedTests++;
    return true;
  } else {
    console.log(`   ‚ùå –ù–ï –ü–†–û–ô–î–ï–ù (—Ä–∞–∑–Ω–∏—Ü–∞ > ${tolerance})`);
    return false;
  }
}

// ============================================================================
// –¢–ï–°–¢ 1: –õ–ò–°–¢ –ü–í –° –®–ò–†–ò–ù–û–ô √ó –î–õ–ò–ù–û–ô
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('1Ô∏è‚É£  –õ–ò–°–¢ –ü–í (—Å —à–∏—Ä–∏–Ω–æ–π √ó –¥–ª–∏–Ω–æ–π)');
console.log('='.repeat(70));

// –®–∏—Ä–∏–Ω–∞ 1–º √ó –î–ª–∏–Ω–∞ 10–º = 10 –º¬≤
// –î–ª—è –õ–∏—Å—Ç –ü–í 404: coefficient = 1.0140127388535
// –í–µ—Å = 1.0140127388535 √ó 7.85 / 1000 √ó 10 –º = 0.0796 —Ç
runTest(
  '–õ–∏—Å—Ç –ü–í 404, —à–∏—Ä–∏–Ω–∞ 1–º √ó –¥–ª–∏–Ω–∞ 10–º',
  {
    metalType: 'sheet_pv',
    size: '404',
    width: 1,
    lengthSheet: 10
  },
  0.0796
);

// –®–∏—Ä–∏–Ω–∞ 1.25–º √ó –î–ª–∏–Ω–∞ 6–º = 7.5 –º¬≤
runTest(
  '–õ–∏—Å—Ç –ü–í 406, —à–∏—Ä–∏–Ω–∞ 1.25–º √ó –¥–ª–∏–Ω–∞ 6–º',
  {
    metalType: 'sheet_pv',
    size: '406',
    width: 1.25,
    lengthSheet: 6
  },
  2 * 7.5 * 7.85 / 1000  // coefficient –¥–ª—è 406 = 2
);

// ============================================================================
// –¢–ï–°–¢ 2: –õ–ò–°–¢/–†–£–õ–û–ù –ì/–ö –° –ü–õ–û–©–ê–î–¨–Æ –ù–ê–ü–†–Ø–ú–£–Æ
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('2Ô∏è‚É£  –õ–ò–°–¢/–†–£–õ–û–ù –ì/–ö (–ø–ª–æ—â–∞–¥—å –Ω–∞–ø—Ä—è–º—É—é)');
console.log('='.repeat(70));

// –ü–ª–æ—â–∞–¥—å 10 –º¬≤ –Ω–∞–ø—Ä—è–º—É—é
// –¢–æ–ª—â–∏–Ω–∞ 2–º–º, —Å—Ç–∞–ª—å —Å—Ç3
// weights["2"] = 15.7 (–≤–µ—Å 1–º¬≤ –≤ –∫–≥)
// –§–æ—Ä–º—É–ª–∞: –≤–µ—Å = weights √ó area √ó steelCoef / 1000
// steelCoef –¥–ª—è —Å—Ç3 = 1.0
runTest(
  '–õ–∏—Å—Ç –≥/–∫ 2–º–º, –ø–ª–æ—â–∞–¥—å 10–º¬≤',
  {
    metalType: 'sheet_hot',
    size: '2',
    area: 10
  },
  15.7 * 10 * 1.0 / 1000  // = 0.157 —Ç
);

// ============================================================================
// –¢–ï–°–¢ 3: –õ–ò–°–¢/–†–£–õ–û–ù –•/–ö –° –®–ò–†–ò–ù–û–ô √ó –î–õ–ò–ù–û–ô
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('3Ô∏è‚É£  –õ–ò–°–¢/–†–£–õ–û–ù –•/–ö (—à–∏—Ä–∏–Ω–∞ √ó –¥–ª–∏–Ω–∞)');
console.log('='.repeat(70));

// –®–∏—Ä–∏–Ω–∞ 1.5–º √ó –î–ª–∏–Ω–∞ 6–º = 9 –º¬≤
// –¢–æ–ª—â–∏–Ω–∞ 1–º–º, weights["1"] = 7.85 (–≤–µ—Å 1–º¬≤ –≤ –∫–≥)
runTest(
  '–õ–∏—Å—Ç —Ö/–∫ 1–º–º, —à–∏—Ä–∏–Ω–∞ 1.5–º √ó –¥–ª–∏–Ω–∞ 6–º',
  {
    metalType: 'sheet_cold',
    size: '1',
    width: 1.5,
    lengthSheet: 6
  },
  7.85 * 9 * 1.0 / 1000  // = 0.07065 —Ç
);

// ============================================================================
// –¢–ï–°–¢ 4: –õ–ò–°–¢ –†–ò–§–õ–ï–ù–´–ô (–¢–û–õ–¨–ö–û –ü–õ–û–©–ê–î–¨, –ë–ï–ó –®–ò–†–ò–ù–´/–î–õ–ò–ù–´)
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('4Ô∏è‚É£  –õ–ò–°–¢ –†–ò–§–õ–ï–ù–´–ô (—Ç–æ–ª—å–∫–æ –ø–ª–æ—â–∞–¥—å)');
console.log('='.repeat(70));

// –ü–ª–æ—â–∞–¥—å 10–º¬≤ –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ —à–∏—Ä–∏–Ω—ã/–¥–ª–∏–Ω—ã)
runTest(
  '–õ–∏—Å—Ç —Ä–∏—Ñ–ª–µ–Ω—ã–π 2.5–º–º, –ø–ª–æ—â–∞–¥—å 10–º¬≤',
  {
    metalType: 'sheet_checkered',
    size: '2.5',
    riffleType: '—á–µ—á–µ–≤–∏—Ü–∞',
    area: 10
  },
  0.201  // 1 √ó 10 √ó 20.1 / 1000
);

// ============================================================================
// –¢–ï–°–¢ 5: –õ–ï–ù–¢–ê/–®–¢–†–ò–ü–° –° –®–ò–†–ò–ù–û–ô √ó –î–õ–ò–ù–û–ô
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('5Ô∏è‚É£  –õ–ï–ù–¢–ê/–®–¢–†–ò–ü–° (—à–∏—Ä–∏–Ω–∞ √ó –¥–ª–∏–Ω–∞)');
console.log('='.repeat(70));

// –®–∏—Ä–∏–Ω–∞ 0.5–º √ó –î–ª–∏–Ω–∞ 100–º = 50 –º¬≤
// –¢–æ–ª—â–∏–Ω–∞ 0.5–º–º, weights["0.5"] = 3.925 (–≤–µ—Å 1–º¬≤ –≤ –∫–≥)
runTest(
  '–õ–µ–Ω—Ç–∞/—à—Ç—Ä–∏–ø—Å 0.5–º–º, —à–∏—Ä–∏–Ω–∞ 0.5–º √ó –¥–ª–∏–Ω–∞ 100–º',
  {
    metalType: 'strip_tape',
    size: '0.5',
    width: 0.5,
    lengthSheet: 100
  },
  3.925 * 50 * 1.0 / 1000  // = 0.19625 —Ç
);

// ============================================================================
// –ò–¢–û–ì–ò
// ============================================================================

console.log('\n' + '='.repeat(70));
console.log('\nüìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:\n');
console.log(`   –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${totalTests}`);
console.log(`   –ü—Ä–æ–π–¥–µ–Ω–æ: ${passedTests} ‚úÖ`);
console.log(`   –ü—Ä–æ–≤–∞–ª–µ–Ω–æ: ${totalTests - passedTests} ‚ùå`);

const percentage = (passedTests / totalTests * 100).toFixed(0);
console.log(`\n   –£—Å–ø–µ—à–Ω–æ—Å—Ç—å: ${percentage}%`);

if (passedTests === totalTests) {
  console.log('\nüéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´! –§–£–ù–ö–¶–ò–û–ù–ê–õ –ì–û–¢–û–í!\n');
  console.log('='.repeat(70));
  process.exit(0);
} else {
  console.log('\n‚ùå –ï–°–¢–¨ –ü–†–û–í–ê–õ–ò–í–®–ò–ï–°–Ø –¢–ï–°–¢–´! –¢–†–ï–ë–£–ï–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï!\n');
  console.log('='.repeat(70));
  process.exit(1);
}
