<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç–∞ 23met</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600 min-h-screen py-8 px-4">

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
  <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-8">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">üèóÔ∏è –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç–∞ 23met</h1>
      <p class="text-gray-600">–¢–æ—á–Ω—ã–π —Ä–∞—Å—á–µ—Ç –≤–µ—Å–∞, –¥–ª–∏–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞</p>
    </div>

    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
      <h3 class="font-bold text-blue-900 mb-2">üìñ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º:</h3>
      <ol class="list-decimal ml-5 text-sm text-blue-800 space-y-1">
        <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–µ—Ç–∞–ª–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ (<strong>70+ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</strong>)</li>
        <li><strong>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑ dropdown</strong> (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è)</li>
        <li>–î–ª—è –∫–∞—Ç–∞–Ω–∫–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É —Å—Ç–∞–ª–∏ (37 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)</li>
        <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–∞—Å—á—ë—Ç–∞: –ø–æ –≤–µ—Å—É / –¥–ª–∏–Ω–µ / –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —à—Ç—É–∫</li>
        <li>–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ - <strong>—Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!</strong></li>
      </ol>

      <div class="mt-3 p-2 bg-white rounded border border-blue-200">
        <p class="text-xs text-blue-700">
          <strong>üí° –ü—Ä–∏–º–µ—Ä:</strong> –ö–∞—Ç–∞–Ω–∫–∞ ‚Üí –†–∞–∑–º–µ—Ä: 10 ‚Üí –°—Ç–∞–ª—å: —Å—Ç3 ‚Üí –ü–æ –¥–ª–∏–Ω–µ: 100 –º–µ—Ç—Ä–æ–≤<br>
          <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –í–µ—Å 1–º = 0.616 –∫–≥, –û–±—â–∏–π –≤–µ—Å = 61.6 –∫–≥
        </p>
      </div>
    </div>

    <!-- –§–æ—Ä–º–∞ -->
    <form id="calculator-form" class="space-y-6">

      <!-- –¢–∏–ø –º–µ—Ç–∞–ª–ª–∞ -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          –¢–∏–ø –º–µ—Ç–∞–ª–ª–∞
          <span id="metal-count" class="text-xs text-gray-500 font-normal"></span>
        </label>
        <select id="metal-type" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition">
          <option value="">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–∞–ª–ª–æ–≤...</option>
        </select>
        <!-- –ì–û–°–¢ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div id="metal-info" class="mt-2 hidden">
          <p class="text-xs text-blue-700">
            <strong>üìã –ì–û–°–¢:</strong> <span id="gost-text" class="font-mono"></span>
          </p>
          <p class="text-xs text-gray-600">
            <strong>üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="category-text"></span>
          </p>
        </div>
      </div>

      <!-- –†–∞–∑–º–µ—Ä -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">–†–∞–∑–º–µ—Ä</label>
        <select
          id="size"
          class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
        >
          <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–µ—Ç–∞–ª–ª–∞ --</option>
        </select>
        <p id="size-hint" class="text-xs text-gray-500 mt-1">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–∞–ª–ª —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã</p>
        <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã -->
        <div id="available-sizes" class="mt-2 hidden">
          <div class="bg-gray-50 border border-gray-200 rounded p-2">
            <p class="text-xs text-gray-700">
              <strong>üìè –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã:</strong>
              <span id="sizes-list" class="font-mono text-blue-600"></span>
            </p>
          </div>
        </div>
      </div>

      <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∫–∞—Ç–∞–Ω–∫–∏ -->
      <div id="katanka-fields" class="hidden space-y-4 border-2 border-blue-200 rounded-lg p-4 bg-blue-50">

        <!-- –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏</label>
          <select id="steel-type" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <optgroup label="–û–±—ã—á–Ω—ã–µ —Å—Ç–∞–ª–∏">
              <option value="—Å—Ç08">—Å—Ç08 (7.871 —Ç/–º¬≥)</option>
              <option value="—Å—Ç0">—Å—Ç0 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç1">—Å—Ç1 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç2">—Å—Ç2 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç3" selected>—Å—Ç3 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç10">—Å—Ç10 (7.856 —Ç/–º¬≥)</option>
              <option value="—Å—Ç15">—Å—Ç15 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç20">—Å—Ç20 (7.859 —Ç/–º¬≥)</option>
              <option value="—Å—Ç30">—Å—Ç30 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç35">—Å—Ç35 (7.826 —Ç/–º¬≥)</option>
              <option value="—Å—Ç40">—Å—Ç40 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç45">—Å—Ç45 (7.826 —Ç/–º¬≥)</option>
              <option value="—Å—Ç50">—Å—Ç50 (7.81 —Ç/–º¬≥)</option>
              <option value="—Å—Ç55">—Å—Ç55 (7.82 —Ç/–º¬≥)</option>
              <option value="—Å—Ç60">—Å—Ç60 (7.8 —Ç/–º¬≥)</option>
            </optgroup>
            <optgroup label="–õ–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞–ª–∏">
              <option value="09–ì2–°">09–ì2–° (7.85 —Ç/–º¬≥)</option>
              <option value="10–ì2">10–ì2 (7.79 —Ç/–º¬≥)</option>
              <option value="15–ì">15–ì (7.81 —Ç/–º¬≥)</option>
              <option value="15–•">15–• (7.83 —Ç/–º¬≥)</option>
              <option value="20–ì">20–ì (7.82 —Ç/–º¬≥)</option>
              <option value="20–•">20–• (7.83 —Ç/–º¬≥)</option>
              <option value="30–ì">30–ì (7.81 —Ç/–º¬≥)</option>
              <option value="30–•">30–• (7.82 —Ç/–º¬≥)</option>
              <option value="35–ì2">35–ì2 (7.79 —Ç/–º¬≥)</option>
              <option value="40–ì">40–ì (7.81 —Ç/–º¬≥)</option>
              <option value="40–•">40–• (7.85 —Ç/–º¬≥)</option>
              <option value="45–ì2">45–ì2 (7.81 —Ç/–º¬≥)</option>
              <option value="45–•">45–• (7.82 —Ç/–º¬≥)</option>
              <option value="50–ì">50–ì (7.81 —Ç/–º¬≥)</option>
              <option value="50–ì2">50–ì2 (7.5 —Ç/–º¬≥)</option>
              <option value="50–•">50–• (7.82 —Ç/–º¬≥)</option>
              <option value="65–ì">65–ì (7.85 —Ç/–º¬≥)</option>
            </optgroup>
            <optgroup label="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞–ª–∏">
              <option value="–£7">–£7 (7.83 —Ç/–º¬≥)</option>
              <option value="–£8">–£8 (7.839 —Ç/–º¬≥)</option>
              <option value="–£10">–£10 (7.81 —Ç/–º¬≥)</option>
              <option value="–£12">–£12 (7.83 —Ç/–º¬≥)</option>
            </optgroup>
            <optgroup label="–ë—ã—Å—Ç—Ä–æ—Ä–µ–∂—É—â–∏–µ —Å—Ç–∞–ª–∏">
              <option value="–†18">–†18 (8.8 —Ç/–º¬≥)</option>
            </optgroup>
          </select>
          <p class="text-xs text-gray-500 mt-1">–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞–ª–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Å</p>
        </div>

        <!-- –î–ª–∏–Ω–∞ 1 —à—Ç—É–∫–∏ -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">–î–ª–∏–Ω–∞ 1 —à—Ç—É–∫–∏ (–º)</label>
          <input
            type="number"
            id="piece-length"
            value="1"
            step="0.1"
            min="0.1"
            placeholder="1"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
          >
          <p class="text-xs text-gray-500 mt-1">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à—Ç—É–∫</p>
        </div>

      </div>

      <!-- –†–µ–∂–∏–º —Ä–∞—Å—á–µ—Ç–∞ -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-3">–†–µ–∂–∏–º —Ä–∞—Å—á–µ—Ç–∞</label>
        <div class="space-y-2">
          <label class="flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">
            <input type="radio" name="calc-mode" value="weight" class="w-4 h-4 text-blue-600" checked>
            <span class="ml-3 text-gray-700">–ü–æ –≤–µ—Å—É (–∫–≥)</span>
          </label>
          <label class="flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">
            <input type="radio" name="calc-mode" value="length" class="w-4 h-4 text-blue-600">
            <span class="ml-3 text-gray-700">–ü–æ –¥–ª–∏–Ω–µ (–º–µ—Ç—Ä—ã)</span>
          </label>
          <label class="flex items-center p-3 border-2 border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition">
            <input type="radio" name="calc-mode" value="pieces" class="w-4 h-4 text-blue-600">
            <span class="ml-3 text-gray-700">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (—à—Ç—É–∫–∏)</span>
          </label>
        </div>
      </div>

      <!-- –ó–Ω–∞—á–µ–Ω–∏–µ -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2" id="value-label">–í–µ—Å (–∫–≥)</label>
        <input
          type="number"
          id="value"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ"
          step="0.01"
          class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
        >
      </div>

      <!-- –û—Ü–∏–Ω–∫–æ–≤–∫–∞ -->
      <div class="border-2 border-gray-200 rounded-lg p-4">
        <label class="flex items-center cursor-pointer">
          <input type="checkbox" id="galvanized" class="w-5 h-5 text-blue-600 rounded">
          <span class="ml-3 text-gray-700 font-semibold">–û—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π</span>
        </label>

        <div id="galv-coef-container" class="mt-4 hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ—Ü–∏–Ω–∫–æ–≤–∫–∏</label>
          <select id="galv-coef" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition">
            <option value="0.03">–õ–µ–≥–∫–∞—è (+3%)</option>
            <option value="0.05">–°—Ä–µ–¥–Ω—è—è (+5%)</option>
            <option value="0.07">–¢—è–∂–µ–ª–∞—è (+7%)</option>
          </select>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è - –µ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç) -->
      <div class="text-center">
        <p class="text-xs text-gray-500 mb-2">‚ú® –†–∞—Å—á—ë—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π</p>
        <button
          type="submit"
          class="px-6 py-2 bg-gray-500 hover:bg-gray-600 text-white text-sm font-semibold rounded-lg transition"
        >
          üîÑ –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Ä—É—á–Ω—É—é
        </button>
      </div>
    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="result-container" class="mt-8 hidden">
      <div id="result-card" class="p-6 rounded-lg border-4">
        <h2 class="text-2xl font-bold mb-4" id="result-title"></h2>
        <div id="result-content" class="space-y-3"></div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º -->
        <div class="mt-6 flex gap-3 flex-wrap">
          <button
            onclick="copyResultToClipboard()"
            type="button"
            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition"
          >
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          </button>
          <button
            onclick="resetCalculator()"
            type="button"
            class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition"
          >
            üîÑ –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç
          </button>
        </div>
      </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading" class="mt-8 hidden">
      <div class="flex items-center justify-center space-x-3">
        <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <span class="text-gray-600 font-semibold">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <div class="text-center mt-8 text-white">
    <p class="text-sm opacity-90">
      Powered by Metal Calculator API ‚Ä¢ 70+ —Ç–∏–ø–æ–≤ –º–µ—Ç–∞–ª–ª–æ–≤ ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ì–û–°–¢—ã
    </p>
    <p class="text-xs opacity-75 mt-2">
      <a href="index.html" class="hover:underline">üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a> ‚Ä¢
      <a href="test.html" class="hover:underline">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
    </p>
  </div>

  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
  <script src="./dist/calculator.browser.js"></script>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let metalDatabase = null;
    let isLoading = false;
    let lastResult = null; // –î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    async function loadDatabase() {
      try {
        const response = await fetch('./database/metals.json');
        if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö');
        metalDatabase = await response.json();
        console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', Object.keys(metalDatabase.metals).length, '–º–µ—Ç–∞–ª–ª–æ–≤');

        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å dropdown –º–µ—Ç–∞–ª–ª–∞–º–∏
        populateMetalDropdown();
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã:', error);
        showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
      }
    }

    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å dropdown –≤—Å–µ–º–∏ –º–µ—Ç–∞–ª–ª–∞–º–∏ –∏–∑ –ë–î —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
    function populateMetalDropdown() {
      const dropdown = document.getElementById('metal-type');
      const metalCountSpan = document.getElementById('metal-count');

      // –û—á–∏—Å—Ç–∏—Ç—å dropdown
      dropdown.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–∞–ª–ª --</option>';

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–µ—Ç–∞–ª–ª—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      const categories = {};
      let totalCount = 0;

      for (const [key, metal] of Object.entries(metalDatabase.metals)) {
        const category = metal.category || '–î—Ä—É–≥–æ–µ';
        if (!categories[category]) {
          categories[category] = [];
        }
        categories[category].push({ key, name: metal.name });
        totalCount++;
      }

      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
      const sortedCategories = Object.keys(categories).sort();

      // –°–æ–∑–¥–∞—ë–º optgroups –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      sortedCategories.forEach(category => {
        const optgroup = document.createElement('optgroup');
        optgroup.label = `${category} (${categories[category].length})`;

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ—Ç–∞–ª–ª—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∏–º–µ–Ω–∏
        categories[category].sort((a, b) => a.name.localeCompare(b.name, 'ru'));

        categories[category].forEach(metal => {
          const option = document.createElement('option');
          option.value = metal.key;
          option.textContent = metal.name;
          optgroup.appendChild(option);
        });

        dropdown.appendChild(optgroup);
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–∞–ª–ª–æ–≤
      metalCountSpan.textContent = `(${totalCount} –¥–æ—Å—Ç—É–ø–Ω–æ)`;
      console.log(`‚úÖ Dropdown –∑–∞–ø–æ–ª–Ω–µ–Ω: ${totalCount} –º–µ—Ç–∞–ª–ª–æ–≤ –≤ ${sortedCategories.length} –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö`);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–µ—Ç–∞–ª–ª–∞
    document.getElementById('metal-type').addEventListener('change', (e) => {
      const metalType = e.target.value;

      if (!metalType || !metalDatabase) return;

      const metal = metalDatabase.metals[metalType];
      if (!metal) return;

      // –ü–æ–∫–∞–∑–∞—Ç—å –ì–û–°–¢ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
      const metalInfo = document.getElementById('metal-info');
      const gostText = document.getElementById('gost-text');
      const categoryText = document.getElementById('category-text');

      gostText.textContent = metal.gost || '–ù–µ —É–∫–∞–∑–∞–Ω';
      categoryText.textContent = metal.category || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
      metalInfo.classList.remove('hidden');

      // ‚úÖ –ó–ê–ü–û–õ–ù–ò–¢–¨ DROPDOWN –†–ê–ó–ú–ï–†–û–í (–¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–∞–ª–ª–æ–≤!)
      const sizeSelect = document.getElementById('size');
      const sizeHint = document.getElementById('size-hint');

      // –û—á–∏—Å—Ç–∏—Ç—å dropdown
      sizeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä --</option>';

      // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã (–∏–∑ sizes –∏–ª–∏ –∏–∑ weights)
      let allSizes = [];

      if (metal.sizes && metal.sizes.length > 0) {
        allSizes = metal.sizes;
      } else if (metal.weights && Object.keys(metal.weights).length > 0) {
        allSizes = Object.keys(metal.weights);
      }

      if (allSizes.length > 0) {
        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å dropdown —Ä–∞–∑–º–µ—Ä–∞–º–∏
        allSizes.forEach(size => {
          const option = document.createElement('option');

          if (Array.isArray(size)) {
            // –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤ (—Ç—Ä—É–±—ã, —É–≥–æ–ª–∫–∏): —Å–æ—Ö—Ä–∞–Ω—è–µ–º JSON, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ
            option.value = JSON.stringify(size);
            option.textContent = size.join('√ó'); // "57√ó3.5"
          } else {
            option.value = size;
            option.textContent = size;
          }

          sizeSelect.appendChild(option);
        });

        sizeHint.textContent = `–î–æ—Å—Ç—É–ø–Ω–æ ${allSizes.length} —Ä–∞–∑–º–µ—Ä–æ–≤`;
      } else {
        sizeHint.textContent = '–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –≤—Ä—É—á–Ω—É—é';
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏ –¥–ª—è –∫–∞—Ç–∞–Ω–∫–∏
      const steelGradeContainer = document.getElementById('katanka-fields');
      if (metalType === 'wire_rod') {
        steelGradeContainer.classList.remove('hidden');
      } else {
        steelGradeContainer.classList.add('hidden');
      }

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–∞–ª–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
      tryAutoCalculate();
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ label –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á–µ—Ç–∞
    document.querySelectorAll('input[name="calc-mode"]').forEach(radio => {
      radio.addEventListener('change', (e) => {
        const valueLabel = document.getElementById('value-label');
        const valueInput = document.getElementById('value');

        const labels = {
          'weight': '–í–µ—Å (–∫–≥)',
          'length': '–î–ª–∏–Ω–∞ (–º–µ—Ç—Ä—ã)',
          'pieces': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç—É–∫–∏)'
        };

        const placeholders = {
          'weight': '–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –≤ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞—Ö',
          'length': '–í–≤–µ–¥–∏—Ç–µ –¥–ª–∏–Ω—É –≤ –º–µ—Ç—Ä–∞—Ö',
          'pieces': '–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫'
        };

        valueLabel.textContent = labels[e.target.value];
        valueInput.placeholder = placeholders[e.target.value];
      });
    });

    // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
    document.getElementById('galvanized').addEventListener('change', (e) => {
      const container = document.getElementById('galv-coef-container');
      container.classList.toggle('hidden', !e.target.checked);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('calculator-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (isLoading) return;

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      if (!metalDatabase) {
        showError('–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.');
        return;
      }

      // –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Ñ–æ—Ä–º—ã
      const metalType = document.getElementById('metal-type').value;
      const size = document.getElementById('size').value.trim();
      const calcMode = document.querySelector('input[name="calc-mode"]:checked').value;
      const value = parseFloat(document.getElementById('value').value);
      const isGalvanized = document.getElementById('galvanized').checked;
      const galvCoef = parseFloat(document.getElementById('galv-coef').value);

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!metalType) {
        showError('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–µ—Ç–∞–ª–ª–∞');
        return;
      }

      if (!size) {
        showError('–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –º–µ—Ç–∞–ª–ª–∞');
        return;
      }

      if (isNaN(value) || value <= 0) {
        showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–±–æ–ª—å—à–µ 0)');
        return;
      }

      // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
      let parsedSize = size;

      // ‚úÖ –î–õ–Ø –¢–†–£–ë, –£–ì–û–õ–ö–û–í, –õ–ò–°–¢–û–í –ò –ü–û–õ–û–°: –ü–∞—Ä—Å–∏–º JSON-—Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –º–∞—Å—Å–∏–≤
      if (metalType.includes('pipe') || metalType.includes('angle') ||
          metalType.includes('sheet') || metalType.includes('strip')) {
        try {
          parsedSize = JSON.parse(size);
        } catch (e) {
          // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
          parsedSize = isNaN(size) ? size : parseFloat(size);
        }
      } else {
        // –î–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Ç–∞–ª–ª–æ–≤: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —á–∏—Å–ª–æ –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
        parsedSize = isNaN(size) ? size : parseFloat(size);
      }

      const params = {
        metalType: metalType,
        size: parsedSize
      };

      // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
      if (calcMode === 'weight') {
        params.weight = value / 1000; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∫–≥ –≤ —Ç–æ–Ω–Ω—ã
      } else if (calcMode === 'length') {
        params.length = value;
      } else if (calcMode === 'pieces') {
        params.pieces = value;
      }

      // –î–ª—è –∫–∞—Ç–∞–Ω–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      if (metalType === 'wire_rod') {
        const steelType = document.getElementById('steel-type').value;
        const pieceLength = parseFloat(document.getElementById('piece-length').value);

        params.steelType = steelType;

        // pieceLength –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à—Ç—É–∫
        // –ù–æ –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –Ω–µ—Ç standardLength –¥–ª—è –∫–∞—Ç–∞–Ω–∫–∏,
        // —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è. –û—Å—Ç–∞–≤–∏–º –Ω–∞ –±—É–¥—É—â–µ–µ.
        if (pieceLength > 0) {
          params.pieceLength = pieceLength;
        }
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
      if (isGalvanized) {
        params.isGalvanized = true;
        params.galvCoef = galvCoef;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      showLoading(true);

      // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç
      try {
        const result = window.MetalCalculator.calculateMetal(params, metalDatabase);

        setTimeout(() => {
          showLoading(false);

          if (result.success) {
            showResult(result);
          } else {
            showError(result.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞');
          }
        }, 300);

      } catch (error) {
        showLoading(false);
        showError('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—á–µ—Ç–∞: ' + error.message);
      }
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    function showResult(result) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
      lastResult = result;

      const container = document.getElementById('result-container');
      const card = document.getElementById('result-card');
      const title = document.getElementById('result-title');
      const content = document.getElementById('result-content');

      // –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –∑–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞
      card.className = 'p-6 rounded-lg border-4 border-green-500 bg-green-50';
      title.textContent = '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞';
      title.className = 'text-2xl font-bold mb-4 text-green-700';

      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
      let html = '';

      html += createResultRow('üì¶ –ú–µ—Ç–∞–ª–ª', result.metalType);

      // ‚úÖ –î–õ–Ø –¢–†–£–ë: –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞–∫ 20√ó2.5
      const formattedSize = Array.isArray(result.size)
        ? result.size.join('√ó') + ' –º–º'
        : (typeof result.size === 'number' ? result.size + ' –º–º' : result.size);

      html += createResultRow('üìè –†–∞–∑–º–µ—Ä', formattedSize);

      // –î–ª—è –∫–∞—Ç–∞–Ω–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Ä–∫—É —Å—Ç–∞–ª–∏
      if (result.steelType) {
        html += createResultRow('üî© –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏', result.steelType);
      }

      html += createResultRow('üìã –ì–û–°–¢', result.gost);
      html += createResultRow('‚öñÔ∏è –í–µ—Å 1 –º–µ—Ç—Ä–∞', result.weightPerMeter.toFixed(3) + ' –∫–≥');

      if (result.weight !== undefined) {
        html += createResultRow('üí∞ –û–±—â–∏–π –≤–µ—Å', (result.weight * 1000).toFixed(2) + ' –∫–≥', true);
      }

      if (result.length !== undefined) {
        html += createResultRow('üìê –î–ª–∏–Ω–∞', result.length.toFixed(2) + ' –º', true);
      }

      if (result.pieces !== undefined) {
        html += createResultRow('üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', result.pieces + ' —à—Ç', true);
      }

      if (result.isGalvanized) {
        html += createResultRow('‚ú® –û—Ü–∏–Ω–∫–æ–≤–∫–∞', '–î–∞', true);
      }

      content.innerHTML = html;
      container.classList.remove('hidden');

      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
      setTimeout(() => {
        container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    // –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function createResultRow(label, value, highlight = false) {
      const bgClass = highlight ? 'bg-green-100' : 'bg-white';
      const textClass = highlight ? 'text-green-900 font-bold text-lg' : 'text-gray-700';

      return `
        <div class="flex justify-between items-center p-3 ${bgClass} rounded-lg">
          <span class="text-gray-600 font-medium">${label}</span>
          <span class="${textClass}">${value}</span>
        </div>
      `;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    function showError(message) {
      const container = document.getElementById('result-container');
      const card = document.getElementById('result-card');
      const title = document.getElementById('result-title');
      const content = document.getElementById('result-content');

      // –û—à–∏–±–∫–∞ - –∫—Ä–∞—Å–Ω–∞—è —Ä–∞–º–∫–∞
      card.className = 'p-6 rounded-lg border-4 border-red-500 bg-red-50';
      title.textContent = '‚ùå –û—à–∏–±–∫–∞';
      title.className = 'text-2xl font-bold mb-4 text-red-700';
      content.innerHTML = `
        <div class="text-red-700">
          <p class="text-lg">${message}</p>
        </div>
      `;

      container.classList.remove('hidden');

      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –æ—à–∏–±–∫–µ
      setTimeout(() => {
        container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }, 100);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    function showLoading(show) {
      isLoading = show;
      const loading = document.getElementById('loading');
      const resultContainer = document.getElementById('result-container');

      if (show) {
        loading.classList.remove('hidden');
        resultContainer.classList.add('hidden');
      } else {
        loading.classList.add('hidden');
      }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyResultToClipboard() {
      if (!lastResult) {
        alert('‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
        return;
      }

      // ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ç—Ä—É–±
      const formattedSize = Array.isArray(lastResult.size)
        ? lastResult.size.join('√ó') + ' –º–º'
        : (typeof lastResult.size === 'number' ? lastResult.size + ' –º–º' : lastResult.size);

      const text = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–°–ß–Å–¢–ê - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä 23met
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üì¶ –ú–µ—Ç–∞–ª–ª: ${lastResult.metalType}
üìè –†–∞–∑–º–µ—Ä: ${formattedSize}
${lastResult.steelType ? `üî© –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏: ${lastResult.steelType}\n` : ''}üìã –ì–û–°–¢: ${lastResult.gost}
üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${lastResult.category}

‚öñÔ∏è  –í–µ—Å 1 –º–µ—Ç—Ä–∞: ${lastResult.weightPerMeter.toFixed(3)} –∫–≥
${lastResult.weight !== undefined ? `üí∞ –û–±—â–∏–π –≤–µ—Å: ${(lastResult.weight * 1000).toFixed(2)} –∫–≥ (${lastResult.weight.toFixed(3)} —Ç)\n` : ''}${lastResult.length !== undefined ? `üìê –î–ª–∏–Ω–∞: ${lastResult.length.toFixed(2)} –º\n` : ''}${lastResult.pieces !== undefined ? `üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${lastResult.pieces} —à—Ç\n` : ''}${lastResult.isGalvanized ? `‚ú® –û—Ü–∏–Ω–∫–æ–≤–∫–∞: –î–∞\n` : ''}
üìÖ –î–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞: ${new Date().toLocaleString('ru-RU')}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Powered by Metal Calculator API ‚Ä¢ 23met
      `.trim();

      navigator.clipboard.writeText(text).then(() => {
        alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      }).catch(err => {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
        alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
      });
    }

    // –°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
    function resetCalculator() {
      // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      document.getElementById('result-container').classList.add('hidden');

      // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
      document.getElementById('calculator-form').reset();

      // –°–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
      document.getElementById('metal-info').classList.add('hidden');
      document.getElementById('available-sizes').classList.add('hidden');
      document.getElementById('katanka-fields').classList.add('hidden');
      document.getElementById('galv-coef-container').classList.add('hidden');

      // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      lastResult = null;

      // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–∞—á–∞–ª—É —Ñ–æ—Ä–º—ã
      document.getElementById('calculator-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // ‚úÖ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –†–ê–°–ß–Å–¢ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UX 2/2)

    // Debounce —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
    async function tryAutoCalculate() {
      // –ü—Ä–æ–≤–µ—Ä–∫–∏
      if (isLoading || !metalDatabase) return;

      const metalType = document.getElementById('metal-type').value;
      const size = document.getElementById('size').value;
      const value = document.getElementById('value').value;

      // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
      if (!metalType || !size || !value || value <= 0) return;

      // –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º submit —Ñ–æ—Ä–º—ã
      const form = document.getElementById('calculator-form');
      const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
      form.dispatchEvent(submitEvent);
    }

    // –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π
    function setupAutoCalculate() {
      // Event listeners –¥–ª—è –ø–æ–ª–µ–π
      const fields = [
        { id: 'metal-type', event: 'change' },
        { id: 'size', event: 'change' },
        { id: 'value', event: 'input', debounced: true },
        { id: 'steel-type', event: 'change' },
        { id: 'piece-length', event: 'input', debounced: true }
      ];

      fields.forEach(({ id, event, debounced }) => {
        const element = document.getElementById(id);
        if (element) {
          if (debounced) {
            element.addEventListener(event, debounce(tryAutoCalculate, 800));
          } else {
            element.addEventListener(event, tryAutoCalculate);
          }
        }
      });

      // Radio buttons –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á—ë—Ç–∞
      document.querySelectorAll('input[name="calc-mode"]').forEach(radio => {
        radio.addEventListener('change', tryAutoCalculate);
      });

      // Checkbox –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
      document.getElementById('galvanized')?.addEventListener('change', tryAutoCalculate);
      document.getElementById('galv-coef')?.addEventListener('change', tryAutoCalculate);

      console.log('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –≤–∫–ª—é—á—ë–Ω');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadDatabase().then(() => {
      // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ë–î –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç
      setupAutoCalculate();
    });
  </script>
</body>
</html>
