<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ============================================================================ */
    /* –í–ó–ê–ò–ú–û–ó–ê–í–ò–°–ò–ú–´–ï –ü–û–õ–Ø –†–ê–°–ß–Å–¢–ê */
    /* ============================================================================ */

    .calculation-fields {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 24px;
      border-radius: 16px;
      margin-bottom: 24px;
      border: 2px solid #dee2e6;
    }

    .section-title {
      margin: 0 0 8px 0;
      font-size: 1.15em;
      font-weight: 700;
      color: #212529;
    }

    .help-text {
      margin: 0 0 20px 0;
      font-size: 0.9em;
      color: #6c757d;
      font-style: italic;
    }

    .form-row {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
    }

    .flex-1 {
      flex: 1;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #495057;
      font-size: 0.95em;
    }

    .field-hint {
      color: #6c757d;
      font-size: 0.85em;
      font-weight: 400;
    }

    .form-control {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #ced4da;
      border-radius: 8px;
      font-size: 1em;
      transition: all 0.2s ease;
      background: white;
    }

    .form-control:focus {
      outline: none;
      border-color: #0066cc;
      box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.15);
    }

    .form-control:hover {
      border-color: #adb5bd;
    }

    .form-control:disabled {
      background: #e9ecef;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .info-box {
      background: linear-gradient(135deg, #e7f3ff 0%, #d0e7ff 100%);
      border-left: 4px solid #0066cc;
      padding: 14px 16px;
      border-radius: 8px;
      font-size: 0.9em;
      color: #495057;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
      }

      .calculation-fields {
        padding: 16px;
      }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è */
    .form-control.filled {
      background: #f0f9ff;
      border-color: #0066cc;
    }

    /* Error box */
    .error-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      color: #856404;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-500 to-purple-600 min-h-screen py-8 px-4">

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
  <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-2xl p-8">

    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">‚öôÔ∏è –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç–∞</h1>
      <p class="text-gray-600">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –≤–µ—Å–∞, –¥–ª–∏–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ –ì–û–°–¢–∞–º</p>
    </div>

    <!-- –§–æ—Ä–º–∞ -->
    <form id="calculator-form" class="space-y-6">

      <!-- –¢–∏–ø –º–µ—Ç–∞–ª–ª–∞ -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">
          –¢–∏–ø –º–µ—Ç–∞–ª–ª–∞
          <span id="metal-count" class="text-xs text-gray-500 font-normal"></span>
        </label>
        <select id="metal-type" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition">
          <option value="">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Ç–∞–ª–ª–æ–≤...</option>
        </select>
        <!-- –ì–û–°–¢ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div id="metal-info" class="mt-2 hidden">
          <p class="text-xs text-blue-700">
            <strong>üìã –ì–û–°–¢:</strong> <span id="gost-text" class="font-mono"></span>
          </p>
          <p class="text-xs text-gray-600">
            <strong>üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span id="category-text"></span>
          </p>
        </div>
      </div>

      <!-- –†–∞–∑–º–µ—Ä -->
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-2">–†–∞–∑–º–µ—Ä</label>
        <select
          id="size"
          class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
        >
          <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –º–µ—Ç–∞–ª–ª–∞ --</option>
        </select>
        <p id="size-hint" class="text-xs text-gray-500 mt-1">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–∞–ª–ª —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã</p>
        <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã -->
        <div id="available-sizes" class="mt-2 hidden">
          <div class="bg-gray-50 border border-gray-200 rounded p-2">
            <p class="text-xs text-gray-700">
              <strong>üìè –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã:</strong>
              <span id="sizes-list" class="font-mono text-blue-600"></span>
            </p>
          </div>
        </div>
      </div>

      <!-- ===== –ù–û–í–´–ô –ë–õ–û–ö: –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–û–õ–Ø –ú–ê–¢–ï–†–ò–ê–õ–ê ===== -->
      <div id="material-properties-container" class="hidden space-y-4 border-2 border-green-200 rounded-lg p-4 bg-green-50">

        <!-- –ü–æ–ª–µ: –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ (–¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤) -->
        <div id="field-steel-type" class="hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏</label>
          <select id="steel-type-select" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É —Å—Ç–∞–ª–∏ --</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞–ª–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á—ë—Ç –≤–µ—Å–∞</p>
        </div>

        <!-- –ü–æ–ª–µ: –°—Ç–∞–Ω–¥–∞—Ä—Ç (–¢–£) (–¥–ª—è –õ–∏—Å—Ç–∞ –ü–í) -->
        <div id="field-standard" class="hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–°—Ç–∞–Ω–¥–∞—Ä—Ç (–¢–£)</label>
          <select id="standard-select" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä --</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">–°—Ç–∞–Ω–¥–∞—Ä—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞</p>
        </div>

        <!-- –ü–æ–ª–µ: –†–∏—Ñ–ª–µ–Ω–∏–µ (–¥–ª—è –õ–∏—Å—Ç–∞ —Ä–∏—Ñ–ª–µ–Ω–æ–≥–æ) -->
        <div id="field-riffle-type" class="hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–¢–∏–ø —Ä–∏—Ñ–ª–µ–Ω–∏—è</label>
          <select id="riffle-type-select" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∏—Ñ–ª–µ–Ω–∏—è --</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">–¢–∏–ø —Ä–∏—Ñ–ª–µ–Ω–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—á—ë—Ç –≤–µ—Å–∞</p>
        </div>

        <!-- –ü–æ–ª–µ: –û—Ü–∏–Ω–∫–æ–≤–∫–∞ (–¥–ª—è —Ç–∏–ø–æ–≤ —Å –æ—Ü–∏–Ω–∫–æ–≤–∫–æ–π) -->
        <div id="field-zinc-option" class="hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–û—Ü–∏–Ω–∫–æ–≤–∫–∞</label>
          <select id="zinc-option-select" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ü–∏–Ω–∫–æ–≤–∫–∏ --</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">–û—Ü–∏–Ω–∫–æ–≤–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ –≤–µ—Å—É –º–µ—Ç–∞–ª–ª–∞</p>
        </div>

        <!-- –ü–æ–ª–µ: –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ (–¥–ª—è –ö–≤–∞–¥—Ä–∞—Ç–∞) -->
        <div id="field-steel-type-square" class="hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏</label>
          <select id="steel-type-square-select" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É —Å—Ç–∞–ª–∏ --</option>
          </select>
          <p class="text-xs text-gray-500 mt-1">–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –∏ –≤–µ—Å –º–µ—Ç–∞–ª–ª–∞</p>
        </div>

      </div>
      <!-- ===== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê: –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–û–õ–Ø –ú–ê–¢–ï–†–ò–ê–õ–ê ===== -->

      <!-- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –∫–∞—Ç–∞–Ω–∫–∏ -->
      <div id="katanka-fields" class="hidden space-y-4 border-2 border-blue-200 rounded-lg p-4 bg-blue-50">

        <!-- –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏</label>
          <select id="steel-type" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition bg-white">
            <optgroup label="–û–±—ã—á–Ω—ã–µ —Å—Ç–∞–ª–∏">
              <option value="—Å—Ç08">—Å—Ç08 (7.871 —Ç/–º¬≥)</option>
              <option value="—Å—Ç0">—Å—Ç0 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç1">—Å—Ç1 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç2">—Å—Ç2 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç3" selected>—Å—Ç3 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç10">—Å—Ç10 (7.856 —Ç/–º¬≥)</option>
              <option value="—Å—Ç15">—Å—Ç15 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç20">—Å—Ç20 (7.859 —Ç/–º¬≥)</option>
              <option value="—Å—Ç30">—Å—Ç30 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç35">—Å—Ç35 (7.826 —Ç/–º¬≥)</option>
              <option value="—Å—Ç40">—Å—Ç40 (7.85 —Ç/–º¬≥)</option>
              <option value="—Å—Ç45">—Å—Ç45 (7.826 —Ç/–º¬≥)</option>
              <option value="—Å—Ç50">—Å—Ç50 (7.81 —Ç/–º¬≥)</option>
              <option value="—Å—Ç55">—Å—Ç55 (7.82 —Ç/–º¬≥)</option>
              <option value="—Å—Ç60">—Å—Ç60 (7.8 —Ç/–º¬≥)</option>
            </optgroup>
            <optgroup label="–õ–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞–ª–∏">
              <option value="09–ì2–°">09–ì2–° (7.85 —Ç/–º¬≥)</option>
              <option value="10–ì2">10–ì2 (7.79 —Ç/–º¬≥)</option>
              <option value="15–ì">15–ì (7.81 —Ç/–º¬≥)</option>
              <option value="15–•">15–• (7.83 —Ç/–º¬≥)</option>
              <option value="20–ì">20–ì (7.82 —Ç/–º¬≥)</option>
              <option value="20–•">20–• (7.83 —Ç/–º¬≥)</option>
              <option value="30–ì">30–ì (7.81 —Ç/–º¬≥)</option>
              <option value="30–•">30–• (7.82 —Ç/–º¬≥)</option>
              <option value="35–ì2">35–ì2 (7.79 —Ç/–º¬≥)</option>
              <option value="40–ì">40–ì (7.81 —Ç/–º¬≥)</option>
              <option value="40–•">40–• (7.85 —Ç/–º¬≥)</option>
              <option value="45–ì2">45–ì2 (7.81 —Ç/–º¬≥)</option>
              <option value="45–•">45–• (7.82 —Ç/–º¬≥)</option>
              <option value="50–ì">50–ì (7.81 —Ç/–º¬≥)</option>
              <option value="50–ì2">50–ì2 (7.5 —Ç/–º¬≥)</option>
              <option value="50–•">50–• (7.82 —Ç/–º¬≥)</option>
              <option value="65–ì">65–ì (7.85 —Ç/–º¬≥)</option>
            </optgroup>
            <optgroup label="–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞–ª–∏">
              <option value="–£7">–£7 (7.83 —Ç/–º¬≥)</option>
              <option value="–£8">–£8 (7.839 —Ç/–º¬≥)</option>
              <option value="–£10">–£10 (7.81 —Ç/–º¬≥)</option>
              <option value="–£12">–£12 (7.83 —Ç/–º¬≥)</option>
            </optgroup>
            <optgroup label="–ë—ã—Å—Ç—Ä–æ—Ä–µ–∂—É—â–∏–µ —Å—Ç–∞–ª–∏">
              <option value="–†18">–†18 (8.8 —Ç/–º¬≥)</option>
            </optgroup>
          </select>
          <p class="text-xs text-gray-500 mt-1">–ü–ª–æ—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞–ª–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–µ—Å</p>
        </div>

        <!-- –î–ª–∏–Ω–∞ 1 —à—Ç—É–∫–∏ -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">–î–ª–∏–Ω–∞ 1 —à—Ç—É–∫–∏ (–º)</label>
          <input
            type="number"
            id="piece-length"
            value="1"
            step="0.1"
            min="0.1"
            placeholder="1"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition"
          >
          <p class="text-xs text-gray-500 mt-1">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à—Ç—É–∫</p>
        </div>

      </div>

      <!-- –í–∑–∞–∏–º–æ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è —Ä–∞—Å—á—ë—Ç–∞ -->
      <div class="calculation-fields">
        <h3 class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á—ë—Ç–∞</h3>
        <p class="help-text">‚ö° –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ª—é–±–æ–µ –ø–æ–ª–µ - –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞—Å—Å—á–∏—Ç–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>

        <div class="form-row">
          <div class="form-group flex-1">
            <label for="input-weight">
              üí∞ –í–µ—Å
              <span class="field-hint">—Ç–æ–Ω–Ω—ã</span>
            </label>
            <input
              type="number"
              id="input-weight"
              class="form-control"
              placeholder="0.000"
              step="0.001"
              min="0"
            >
          </div>

          <div class="form-group flex-1" id="field-length">
            <label for="input-length">
              üìê –î–ª–∏–Ω–∞
              <span class="field-hint">–º–µ—Ç—Ä—ã</span>
            </label>
            <input
              type="number"
              id="input-length"
              class="form-control"
              placeholder="0.00"
              step="0.01"
              min="0"
            >
          </div>

          <!-- –ü–æ–ª–µ: –î–ª–∏–Ω–∞ 1 —à—Ç. (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤) -->
          <div class="form-group flex-1" id="field-length-per-piece" style="display: none;">
            <label for="input-length-per-piece">
              üìè –î–ª–∏–Ω–∞ 1 —à—Ç.
              <span class="field-hint">–º–µ—Ç—Ä—ã</span>
            </label>
            <input
              type="number"
              id="input-length-per-piece"
              class="form-control"
              placeholder="12"
              value="12"
              step="0.1"
              min="0.1"
            >
          </div>

          <div class="form-group flex-1">
            <label for="input-pieces">
              üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
              <span class="field-hint">—à—Ç—É–∫–∏</span>
            </label>
            <input
              type="number"
              id="input-pieces"
              class="form-control"
              placeholder="0"
              step="1"
              min="0"
            >
          </div>
        </div>

        <!-- ===== –ü–û–õ–Ø –î–õ–Ø –õ–ò–°–¢–û–í–´–• –ú–ï–¢–ê–õ–õ–û–í (–û–¢–î–ï–õ–¨–ù–´–ï –ë–õ–û–ö–ò) ===== -->

        <!-- –ü–æ–ª–µ "–ü–ª–æ—â–∞–¥—å" –£–î–ê–õ–ï–ù–û - –ø–ª–æ—â–∞–¥—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —à—Ç—É–∫ –∏–∑ —à–∏—Ä–∏–Ω—ã √ó –¥–ª–∏–Ω—ã -->

        <!-- –ü–æ–ª–µ: –®–∏—Ä–∏–Ω–∞ -->
        <div class="form-row" id="field-width" style="display: none;">
          <div class="form-group flex-1">
            <label for="input-width">
              ‚ÜîÔ∏è –®–∏—Ä–∏–Ω–∞
              <span class="field-hint">–º–µ—Ç—Ä—ã</span>
            </label>
            <input
              type="number"
              id="input-width"
              class="form-control"
              placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 1.25"
              step="0.01"
              min="0"
            >
          </div>
        </div>

        <!-- –ü–æ–ª–µ: –î–ª–∏–Ω–∞ –ª–∏—Å—Ç–∞ -->
        <div class="form-row" id="field-length-sheet" style="display: none;">
          <div class="form-group flex-1">
            <label for="input-length-sheet">
              ‚ÜïÔ∏è –î–ª–∏–Ω–∞ –ª–∏—Å—Ç–∞
              <span class="field-hint">–º–µ—Ç—Ä—ã</span>
            </label>
            <input
              type="number"
              id="input-length-sheet"
              class="form-control"
              placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 6"
              step="0.01"
              min="0"
            >
          </div>
        </div>

        <!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å -->
        <div id="calculated-area-box" class="info-box" style="display: none; margin-top: 8px; background: #e3f2fd; border-left: 4px solid #2196f3;">
          <strong>üìê –ü–ª–æ—â–∞–¥—å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):</strong>
          <span id="calculated-area-value">0</span> –º¬≤
        </div>

        <div class="info-box">
          ‚ÑπÔ∏è –ó–Ω–∞—á–µ–Ω–∏—è –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –∫—Ä–∞—Ç–Ω–æ —à—Ç—É–∫–∞–º (–≤—Å–µ–≥–¥–∞ –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É)
        </div>
      </div>

      <!-- –û—Ü–∏–Ω–∫–æ–≤–∫–∞ -->
      <div class="border-2 border-gray-200 rounded-lg p-4">
        <label class="flex items-center cursor-pointer">
          <input type="checkbox" id="galvanized" class="w-5 h-5 text-blue-600 rounded">
          <span class="ml-3 text-gray-700 font-semibold">–û—Ü–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π</span>
        </label>

        <div id="galv-coef-container" class="mt-4 hidden">
          <label class="block text-sm font-semibold text-gray-700 mb-2">–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –æ—Ü–∏–Ω–∫–æ–≤–∫–∏</label>
          <select id="galv-coef" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none transition">
            <option value="0.03">–õ–µ–≥–∫–∞—è (+3%)</option>
            <option value="0.05">–°—Ä–µ–¥–Ω—è—è (+5%)</option>
            <option value="0.07">–¢—è–∂–µ–ª–∞—è (+7%)</option>
          </select>
        </div>
      </div>

    </form>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="result-container" class="mt-8 hidden">
      <div id="result-card" class="p-6 rounded-lg border-4">
        <h2 class="text-2xl font-bold mb-4" id="result-title"></h2>
        <div id="result-content" class="space-y-3"></div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º -->
        <div class="mt-6 flex gap-3 flex-wrap">
          <button
            onclick="copyResultToClipboard()"
            type="button"
            class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition"
          >
            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          </button>
          <button
            onclick="resetCalculator()"
            type="button"
            class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-lg transition"
          >
            üîÑ –ù–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç
          </button>
        </div>
      </div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading" class="mt-8 hidden">
      <div class="flex items-center justify-center space-x-3">
        <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
        <span class="text-gray-600 font-semibold">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </div>

  </div>

  <!-- Footer -->
  <div class="text-center mt-8 text-white">
    <p class="text-sm opacity-90">
      Powered by Metal Calculator API ‚Ä¢ 70+ —Ç–∏–ø–æ–≤ –º–µ—Ç–∞–ª–ª–æ–≤ ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ì–û–°–¢—ã
    </p>
    <p class="text-xs opacity-75 mt-2">
      <a href="index.html" class="hover:underline">üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a> ‚Ä¢
      <a href="test.html" class="hover:underline">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
    </p>
  </div>

  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ -->
  <script src="./dist/calculator.browser.js"></script>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let metalDatabase = null;
    let isLoading = false;
    let lastResult = null; // –î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    async function loadDatabase() {
      try {
        const response = await fetch('./database/metals.json');
        if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö');
        metalDatabase = await response.json();
        console.log('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', Object.keys(metalDatabase.metals).length, '–º–µ—Ç–∞–ª–ª–æ–≤');

        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å dropdown –º–µ—Ç–∞–ª–ª–∞–º–∏
        populateMetalDropdown();
      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã:', error);
        showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
      }
    }

    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å dropdown –≤—Å–µ–º–∏ –º–µ—Ç–∞–ª–ª–∞–º–∏ –∏–∑ –ë–î —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
    function populateMetalDropdown() {
      const dropdown = document.getElementById('metal-type');
      const metalCountSpan = document.getElementById('metal-count');

      // –û—á–∏—Å—Ç–∏—Ç—å dropdown
      dropdown.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–∞–ª–ª --</option>';

      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –º–µ—Ç–∞–ª–ª—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      const categories = {};
      let totalCount = 0;

      for (const [key, metal] of Object.entries(metalDatabase.metals)) {
        const category = metal.category || '–î—Ä—É–≥–æ–µ';
        if (!categories[category]) {
          categories[category] = [];
        }
        categories[category].push({ key, name: metal.name });
        totalCount++;
      }

      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É
      const sortedCategories = Object.keys(categories).sort();

      // –°–æ–∑–¥–∞—ë–º optgroups –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      sortedCategories.forEach(category => {
        const optgroup = document.createElement('optgroup');
        optgroup.label = `${category} (${categories[category].length})`;

        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ—Ç–∞–ª–ª—ã –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ –∏–º–µ–Ω–∏
        categories[category].sort((a, b) => a.name.localeCompare(b.name, 'ru'));

        categories[category].forEach(metal => {
          const option = document.createElement('option');
          option.value = metal.key;
          option.textContent = metal.name;
          optgroup.appendChild(option);
        });

        dropdown.appendChild(optgroup);
      });

      // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç–∞–ª–ª–æ–≤
      metalCountSpan.textContent = `(${totalCount} –¥–æ—Å—Ç—É–ø–Ω–æ)`;
      console.log(`‚úÖ Dropdown –∑–∞–ø–æ–ª–Ω–µ–Ω: ${totalCount} –º–µ—Ç–∞–ª–ª–æ–≤ –≤ ${sortedCategories.length} –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö`);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–µ—Ç–∞–ª–ª–∞
    document.getElementById('metal-type').addEventListener('change', (e) => {
      const metalType = e.target.value;

      if (!metalType || !metalDatabase) return;

      const metal = metalDatabase.metals[metalType];
      if (!metal) return;

      // üîß –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –û–±–Ω–æ–≤–∏—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–ª–µ–π —à–∏—Ä–∏–Ω—ã/–¥–ª–∏–Ω—ã
      console.log('üìä –í—ã–±—Ä–∞–Ω —Ç–∏–ø –º–µ—Ç–∞–ª–ª–∞:', metalType);
      updateSheetFieldsVisibility();

      // üîì –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ –º–µ—Ç–∞–ª–ª–∞
      if (inputPriority) {
        console.log(`üîì –°–±—Ä–æ—à–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ –º–µ—Ç–∞–ª–ª–∞: ${inputPriority}`);
        inputPriority = null;
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å –ì–û–°–¢ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
      const metalInfo = document.getElementById('metal-info');
      const gostText = document.getElementById('gost-text');
      const categoryText = document.getElementById('category-text');

      gostText.textContent = metal.gosts?.all || metal.gost || '–ù–µ —É–∫–∞–∑–∞–Ω';
      categoryText.textContent = metal.category || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';
      metalInfo.classList.remove('hidden');

      // ‚úÖ –ó–ê–ü–û–õ–ù–ò–¢–¨ DROPDOWN –†–ê–ó–ú–ï–†–û–í (–¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–∞–ª–ª–æ–≤!)
      const sizeSelect = document.getElementById('size');
      const sizeHint = document.getElementById('size-hint');

      // –û—á–∏—Å—Ç–∏—Ç—å dropdown
      sizeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä --</option>';

      // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞–∑–º–µ—Ä—ã (–∏–∑ sizes –∏–ª–∏ –∏–∑ weights)
      let allSizes = [];

      if (metal.sizes && metal.sizes.length > 0) {
        allSizes = metal.sizes;
      } else if (metal.weights && Object.keys(metal.weights).length > 0) {
        allSizes = Object.keys(metal.weights);
      }

      if (allSizes.length > 0) {
        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å dropdown —Ä–∞–∑–º–µ—Ä–∞–º–∏
        allSizes.forEach(size => {
          const option = document.createElement('option');

          if (Array.isArray(size)) {
            // –î–ª—è –º–∞—Å—Å–∏–≤–æ–≤ (—Ç—Ä—É–±—ã, —É–≥–æ–ª–∫–∏): —Å–æ—Ö—Ä–∞–Ω—è–µ–º JSON, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ
            option.value = JSON.stringify(size);
            option.textContent = size.join('√ó'); // "57√ó3.5"
          } else {
            option.value = size;
            option.textContent = size;
          }

          sizeSelect.appendChild(option);
        });

        sizeHint.textContent = `–î–æ—Å—Ç—É–ø–Ω–æ ${allSizes.length} —Ä–∞–∑–º–µ—Ä–æ–≤`;
      } else {
        sizeHint.textContent = '–í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –≤—Ä—É—á–Ω—É—é';
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏ –¥–ª—è –∫–∞—Ç–∞–Ω–∫–∏
      const steelGradeContainer = document.getElementById('katanka-fields');
      if (metalType === 'wire_rod') {
        steelGradeContainer.classList.remove('hidden');
      } else {
        steelGradeContainer.classList.add('hidden');
      }

      // ===== –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü–û–ö–ê–ó–ê–¢–¨/–°–ö–†–´–¢–¨ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –ü–û–õ–Ø =====
      updateMaterialPropertiesFields(metalType, metal);

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –º–µ—Ç–∞–ª–ª–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
      tryAutoCalculate();
    });

    // –ü–æ–∫–∞–∑/—Å–∫—Ä—ã—Ç–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
    document.getElementById('galvanized').addEventListener('change', (e) => {
      const container = document.getElementById('galv-coef-container');
      container.classList.toggle('hidden', !e.target.checked);
    });

    // ============================================================================
    // –í–ó–ê–ò–ú–û–ó–ê–í–ò–°–ò–ú–´–ï –ü–û–õ–Ø (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)
    // ============================================================================

    // ‚úÖ –¢–ò–ü–´ –° –ü–û–õ–ï–ú "–î–õ–ò–ù–ê 1 –®–¢." (42 —Ç–∏–ø–∞)
    const TYPES_WITH_LENGTH_FIELD = [
      // –ê—Ä–º–∞—Ç—É—Ä–∞ (6)
      'armature_a1', 'armature_a1_galv', 'armature_a3', 'armature_a3_galv',
      'armature_at800', 'armature_at1000',
      // –ë–∞–ª–∫–∞, –ö–∞—Ç–∞–Ω–∫–∞, –ö–≤–∞–¥—Ä–∞—Ç (3)
      'beam', 'wire_rod', 'square',
      // –ö—Ä—É–≥ (2)
      'circle', 'circle_galv',
      // –ü–æ–ª–æ—Å–∞ (3)
      'strip', 'strip_galv', 'bulb_flat',
      // –†–µ–ª—å—Å (1)
      'rail',
      // –¢—Ä—É–±—ã (18)
      'pipe_vgp', 'pipe_vgp_galv', 'pipe_pnd',
      'pipe_seamless_hot', 'pipe_seamless_hot_galv', 'pipe_boiler',
      'pipe_seamless_cold', 'pipe_seamless_cold_galv',
      'pipe_square', 'pipe_square_galv',
      'pipe_oval', 'pipe_oval_galv',
      'pipe_flatoval', 'pipe_flatoval_galv',
      'pipe_rect', 'pipe_rect_galv',
      'pipe_es', 'pipe_es_galv',
      // –£–≥–æ–ª–æ–∫ (4)
      'angle', 'angle_bent', 'angle_bent_galv', 'angle_galv',
      // –®–≤–µ–ª–ª–µ—Ä (4)
      'channel', 'channel_bent', 'channel_bent_galv', 'channel_galv',
      // –®–µ—Å—Ç–∏–≥—Ä–∞–Ω–Ω–∏–∫ (1)
      'hexagon'
    ];

    // ‚úÖ –ö–†–ï–ü–ï–ñ–ò (9 —Ç–∏–ø–æ–≤) - —Ç–æ–ª—å–∫–æ "–í–µ—Å" –∏ "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫", –ë–ï–ó –ø–æ–ª—è "–î–ª–∏–Ω–∞"
    const FASTENER_TYPES = [
      'bolt',         // –ë–æ–ª—Ç—ã
      'screw',        // –í–∏–Ω—Ç—ã
      'nut',          // –ì–∞–π–∫–∏
      'nail',         // –ì–≤–æ–∑–¥–∏
      'selftapping',  // –°–∞–º–æ—Ä–µ–∑—ã
      'washer',       // –®–∞–π–±—ã
      'stud',         // –®–ø–∏–ª—å–∫–∏
      'cotter',       // –®–ø–ª–∏–Ω—Ç—ã
      'woodscrew'     // –®—É—Ä—É–ø—ã
    ];

    let isCalculating = false;  // –§–ª–∞–≥ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤
    let debounceTimer = null;   // –¢–∞–π–º–µ—Ä –¥–ª—è debounce
    let inputPriority = null;   // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: 'weight', 'length', 'pieces' - –∫–∞–∫–æ–µ –ø–æ–ª–µ –≤–≤–µ–ª–∏ –ø–µ—Ä–≤—ã–º
    let isUpdating = false;     // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø–æ–ª–µ–π (–Ω–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    let isRecalculatingFromMaterialChange = false;  // –§–ª–∞–≥: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏/–æ—Ü–∏–Ω–∫–æ–≤–∫–∏ (–Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —à—Ç—É–∫–∏!)

    // –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–ª—è
    const weightInput = document.getElementById('input-weight');
    const lengthInput = document.getElementById('input-length');
    const lengthPerPieceInput = document.getElementById('input-length-per-piece');
    const piecesInput = document.getElementById('input-pieces');
    const areaInput = null;  // –ü–æ–ª–µ –ø–ª–æ—â–∞–¥–∏ –£–î–ê–õ–ï–ù–û - –ø–ª–æ—â–∞–¥—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    const widthInput = document.getElementById('input-width');
    const lengthSheetInput = document.getElementById('input-length-sheet');

    /**
     * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–ª–æ—â–∞–¥–∏ –∏–∑ —à–∏—Ä–∏–Ω—ã √ó –¥–ª–∏–Ω—ã
     */
    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–æ—â–∞–¥—å –û–î–ù–û–ì–û –ª–∏—Å—Ç–∞ (–ù–ï –æ–±—â—É—é –ø–ª–æ—â–∞–¥—å!)
     * –≠—Ç–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
     */
    function showSheetArea() {
      const width = parseFloat(widthInput.value);
      const length = parseFloat(lengthSheetInput.value);

      if (width && length && width > 0 && length > 0) {
        const areaPerPiece = width * length;
        document.getElementById('calculated-area-value').textContent = areaPerPiece.toFixed(2);
        document.getElementById('calculated-area-box').style.display = 'block';
      } else {
        document.getElementById('calculated-area-box').style.display = 'none';
      }
    }

    /**
     * –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¢–û–õ–¨–ö–û –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫
     * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã/–¥–ª–∏–Ω—ã –û–î–ù–û–ì–û –ª–∏—Å—Ç–∞
     * –ù–ï –º–µ–Ω—è–µ—Ç —Ç–æ–Ω–Ω—ã, –º–µ—Ç—Ä—ã –∏–ª–∏ –ø–ª–æ—â–∞–¥—å!
     */
    function recalculatePiecesOnly() {
      const metalType = document.getElementById('metal-type').value;
      if (!metalType) return;

      // ‚ö†Ô∏è –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –§–õ–ê–ì: –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è pieces
      isUpdating = true;

      try {
        // –õ–∏–Ω–µ–π–Ω—ã–µ —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –º–µ—Ç—Ä—ã, –ø–ª–æ—â–∞–¥–Ω—ã–µ - –∫–≤.–º–µ—Ç—Ä—ã
        // –¢–û–õ–¨–ö–û –ö—Ä—É–≥ –∏ –ö–∞–Ω–∞—Ç - –ª–∏–Ω–µ–π–Ω—ã–µ —Ç–∏–ø—ã (–≤–µ—Å –Ω–∞ –ø–æ–≥–æ–Ω–Ω—ã–π –º–µ—Ç—Ä)
        // –õ–∏—Å—Ç –ü–í - –ü–õ–û–©–ê–î–ù–û–ô —Ç–∏–ø (–∏–º–µ–µ—Ç —à–∏—Ä–∏–Ω—É –∏ –¥–ª–∏–Ω—É –ª–∏—Å—Ç–∞)
        const linearTypes = ['circle', 'circle_galv', 'rope'];
        const isLinearType = linearTypes.includes(metalType);

        let totalValue = null;  // –û–±—â–∏–µ –º–µ—Ç—Ä—ã –∏–ª–∏ –∫–≤.–º–µ—Ç—Ä—ã

        if (isLinearType) {
          // –î–ª—è –ª–∏–Ω–µ–π–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–µ—Ä—ë–º –ú–ï–¢–†–´ –∏–∑ –ø–æ–ª—è "–î–ª–∏–Ω–∞"
          totalValue = parseFloat(lengthInput.value);
        } else {
          // –î–ª—è –ø–ª–æ—â–∞–¥–Ω—ã—Ö —Ç–∏–ø–æ–≤ –±–µ—Ä—ë–º –ö–í.–ú–ï–¢–†–´ –∏–∑ –ø–æ–ª—è "–î–ª–∏–Ω–∞"
          // (Backend –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–æ—â–∞–¥—å –≤ —ç—Ç–æ –ø–æ–ª–µ –¥–ª—è –ø–ª–æ—â–∞–¥–Ω—ã—Ö —Ç–∏–ø–æ–≤)
          totalValue = parseFloat(lengthInput.value);
        }

        if (!totalValue || totalValue <= 0) {
          // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞
          piecesInput.value = '';
          return;
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä—ã –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
        const width = parseFloat(widthInput.value);
        const lengthSheet = parseFloat(lengthSheetInput.value);

        if (isLinearType) {
          // –õ–ò–ù–ï–ô–ù–´–ô –¢–ò–ü: pieces = –º–µ—Ç—Ä—ã / –¥–ª–∏–Ω–∞_1_—à—Ç
          if (lengthSheet && lengthSheet > 0) {
            const pieces = Math.ceil(totalValue / lengthSheet);
            piecesInput.value = pieces;
            console.log(`üìä –ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã —à—Ç—É–∫–∏ (–ª–∏–Ω–µ–π–Ω—ã–π): ${totalValue} –º / ${lengthSheet} –º = ${pieces} —à—Ç`);
          } else {
            piecesInput.value = '';
          }
        } else {
          // –ü–õ–û–©–ê–î–ù–û–ô –¢–ò–ü: pieces = –∫–≤.–º–µ—Ç—Ä—ã / (—à–∏—Ä–∏–Ω–∞ √ó –¥–ª–∏–Ω–∞)
          if (width && width > 0 && lengthSheet && lengthSheet > 0) {
            const areaPerPiece = width * lengthSheet;
            const pieces = Math.ceil(totalValue / areaPerPiece);
            piecesInput.value = pieces;
            console.log(`üìä –ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã —à—Ç—É–∫–∏ (–ø–ª–æ—â–∞–¥–Ω–æ–π): ${totalValue} –º¬≤ / (${width} √ó ${lengthSheet}) = ${pieces} —à—Ç`);
          } else {
            piecesInput.value = '';
          }
        }
      } finally {
        // ‚ö†Ô∏è –°–ù–ò–ú–ê–ï–ú –§–õ–ê–ì: –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
        isUpdating = false;
      }
    }

    /**
     * –§—É–Ω–∫—Ü–∏—è clearWidthLength() –£–î–ê–õ–ï–ù–ê - –ø–æ–ª–µ –ø–ª–æ—â–∞–¥–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç
     */

    /**
     * –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –ø–æ–ª—è –æ—Ç –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
     * @param {string} sourceField - –ö–∞–∫–æ–µ –ø–æ–ª–µ –∏–∑–º–µ–Ω–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ('weight'|'length'|'pieces'|'area')
     */
    function recalculateFields(sourceField) {
      // –ò–∑–±–µ–≥–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤
      if (isCalculating) return;
      isCalculating = true;

      try {
        // –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–∞–ª–ª –∏ —Ä–∞–∑–º–µ—Ä
        const metalType = document.getElementById('metal-type').value;
        const sizeValue = document.getElementById('size').value;

        if (!metalType || !sizeValue) {
          isCalculating = false;
          return;  // –ú–µ—Ç–∞–ª–ª –∏–ª–∏ —Ä–∞–∑–º–µ—Ä –Ω–µ –≤—ã–±—Ä–∞–Ω—ã
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
        let inputValue;
        if (sourceField === 'weight') {
          inputValue = parseFloat(weightInput.value);
        } else if (sourceField === 'length') {
          inputValue = parseFloat(lengthInput.value);
        } else if (sourceField === 'pieces') {
          inputValue = parseInt(piecesInput.value);
        }
        // sourceField === 'area' —É–¥–∞–ª—ë–Ω - –ø–æ–ª—è –ø–ª–æ—â–∞–¥–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç

        // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ –∏–ª–∏ 0 - –æ—á–∏—Å—Ç–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ
        if (!inputValue || inputValue <= 0) {
          if (sourceField !== 'weight') weightInput.value = '';
          if (sourceField !== 'length') lengthInput.value = '';
          if (sourceField !== 'pieces') piecesInput.value = '';
          // areaInput —É–¥–∞–ª—ë–Ω
          hideResult();
          isCalculating = false;
          return;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞
        let parsedSize;
        try {
          parsedSize = JSON.parse(sizeValue);
        } catch {
          parsedSize = isNaN(sizeValue) ? sizeValue : parseFloat(sizeValue);
        }

        // –°–æ–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞
        const params = {
          metalType: metalType,
          size: parsedSize
        };

        // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä
        if (sourceField === 'weight') {
          params.weight = inputValue;
        } else if (sourceField === 'length') {
          params.length = inputValue;
        } else if (sourceField === 'pieces') {
          params.pieces = inputValue;
        }
        // params.area —É–¥–∞–ª—ë–Ω - –ø–æ–ª—è –ø–ª–æ—â–∞–¥–∏ –±–æ–ª—å—à–µ –Ω–µ—Ç

        // –ï—Å–ª–∏ –≤–≤–µ–¥–µ–Ω—ã —à–∏—Ä–∏–Ω–∞ –∏ –¥–ª–∏–Ω–∞ –ª–∏—Å—Ç–∞ - –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö –≤ params
        const width = parseFloat(widthInput.value);
        const lengthSheet = parseFloat(lengthSheetInput.value);
        if (width && lengthSheet && width > 0 && lengthSheet > 0) {
          params.width = width;
          params.lengthSheet = lengthSheet;
        }

        // ‚úÖ –ù–û–í–û–ï: –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ –ø–æ–ª–µ "–î–ª–∏–Ω–∞ 1 —à—Ç." - –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∫ lengthSheet
        const lengthPerPieceInput = document.getElementById('input-length-per-piece');
        const fieldLengthPerPiece = document.getElementById('field-length-per-piece');
        const isLengthPerPieceVisible = fieldLengthPerPiece && fieldLengthPerPiece.style.display !== 'none';

        if (isLengthPerPieceVisible && lengthPerPieceInput && lengthPerPieceInput.value) {
          const lengthPerPiece = parseFloat(lengthPerPieceInput.value);
          if (lengthPerPiece > 0) {
            params.lengthSheet = lengthPerPiece;  // Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —à—Ç—É–∫
            console.log('  ‚úÖ lengthSheet (–∏–∑ "–î–ª–∏–Ω–∞ 1 —à—Ç."):', lengthPerPiece, '–º');
          }
        }

        // ===== –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ü–ï–†–ï–î–ê–ß–ê –ü–ê–†–ê–ú–ï–¢–†–û–í –ú–ê–¢–ï–†–ò–ê–õ–ê =====

        // 1. –ú–ê–†–ö–ê –°–¢–ê–õ–ò (–¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤)
        const typesWithSteel = ['circle', 'circle_galv', 'strip_tape', 'strip_tape_painted', 'strip_tape_galv',
                                'sheet_hot', 'sheet_painted', 'sheet_galv', 'sheet_cold', 'plate'];
        if (typesWithSteel.includes(metalType)) {
          const steelTypeSelect = document.getElementById('steel-type-select');
          if (steelTypeSelect && steelTypeSelect.value) {
            params.steelType = steelTypeSelect.value;
            console.log('  ‚úÖ steelType:', params.steelType);
          }
        }

        // 2. –°–¢–ê–ù–î–ê–†–¢ (–¢–£) (–¥–ª—è –õ–∏—Å—Ç–∞ –ü–í)
        if (metalType === 'sheet_pv' || metalType === 'sheet_pv_galv') {
          const standardSelect = document.getElementById('standard-select');
          if (standardSelect && standardSelect.value) {
            params.standard = standardSelect.value;
            console.log('  ‚úÖ standard:', params.standard);
          }
        }

        // 3. –†–ò–§–õ–ï–ù–ò–ï (–¥–ª—è –õ–∏—Å—Ç–∞ —Ä–∏—Ñ–ª–µ–Ω–æ–≥–æ)
        if (metalType === 'sheet_checkered') {
          const riffleTypeSelect = document.getElementById('riffle-type-select');
          if (riffleTypeSelect && riffleTypeSelect.value) {
            params.riffleType = riffleTypeSelect.value;
            console.log('  ‚úÖ riffleType:', params.riffleType);
          }
        }

        // 4. –û–¶–ò–ù–ö–û–í–ö–ê (–¥–ª—è —Ç–∏–ø–æ–≤ —Å –æ—Ü–∏–Ω–∫–æ–≤–∫–æ–π)
        const typesWithZinc = ['strip_tape_painted', 'strip_tape_galv', 'sheet_painted', 'sheet_galv', 'sheet_pv_galv'];
        if (typesWithZinc.includes(metalType)) {
          const zincOptionSelect = document.getElementById('zinc-option-select');
          if (zincOptionSelect && zincOptionSelect.value) {
            params.zincOption = zincOptionSelect.value;
            console.log('  ‚úÖ zincOption:', params.zincOption);
          }
        }

        // 5. –ú–ê–†–ö–ê –°–¢–ê–õ–ò (–¥–ª—è –ö–≤–∞–¥—Ä–∞—Ç–∞)
        if (metalType === 'square') {
          const steelTypeSquareSelect = document.getElementById('steel-type-square-select');
          if (steelTypeSquareSelect && steelTypeSquareSelect.value) {
            params.steelType = steelTypeSquareSelect.value;
            console.log('  ‚úÖ steelType (–¥–ª—è –ö–≤–∞–¥—Ä–∞—Ç–∞):', params.steelType);
          }
        }

        // ===== –°–¢–ê–†–ê–Ø –õ–û–ì–ò–ö–ê (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∫–∞—Ç–∞–Ω–∫–æ–π) =====
        const katankaFields = document.getElementById('katanka-fields');
        if (metalType === 'wire_rod' && !katankaFields.classList.contains('hidden')) {
          const steelType = document.getElementById('steel-type');
          if (steelType) {
            params.steelType = steelType.value;
          }
        }

        // –°—Ç–∞—Ä–∞—è –æ—Ü–∏–Ω–∫–æ–≤–∫–∞ (checkbox) - –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        const isGalvanized = document.getElementById('galvanized').checked;
        if (isGalvanized) {
          params.isGalvanized = true;
          params.galvCoef = parseFloat(document.getElementById('galv-coef').value);
        }

        // –í–´–ó–í–ê–¢–¨ –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†
        const result = calculateMetal(params, metalDatabase);

        // ‚úÖ –û–¢–õ–ê–î–ö–ê
        console.log('=== –û–¢–õ–ê–î–ö–ê recalculateFields ===');
        console.log('sourceField:', sourceField);
        console.log('result.success:', result.success);
        console.log('result.actual:', result.actual);
        console.log('result.actual.pieces:', result.actual ? result.actual.pieces : 'undefined');
        console.log('result.standardLength:', result.standardLength);
        console.log('–£—Å–ª–æ–≤–∏–µ pieces:', sourceField !== 'pieces', '&&', result.actual && result.actual.pieces !== null);
        console.log('================================');

        if (result.success) {
          // ‚ö†Ô∏è –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –§–õ–ê–ì: –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π (–Ω–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
          isUpdating = true;

          try {
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–∫—Ä–æ–º–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
            // –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï: –ï—Å–ª–∏ –≤–µ—Å –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —à—Ç—É–∫ - –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–µ!
            if (result.actual.weight !== null) {
              const requestedWeight = parseFloat(weightInput.value);
              const calculatedWeight = result.actual.weight;
              const weightChanged = Math.abs(calculatedWeight - requestedWeight) > 0.001;

              // –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å, –µ—Å–ª–∏:
              // 1. sourceField !== 'weight' (–æ–±—ã—á–Ω—ã–π —Å–ª—É—á–∞–π) –ò–õ–ò
              // 2. –í–µ—Å –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —à—Ç—É–∫
              if (sourceField !== 'weight' || weightChanged) {
                weightInput.value = result.actual.weight.toFixed(3);
                if (weightChanged && sourceField === 'weight') {
                  console.log(`‚ö†Ô∏è –í–µ—Å –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è: ${requestedWeight.toFixed(3)} ‚Üí ${calculatedWeight.toFixed(3)}`);
                }
                console.log('‚úÖ Weight –∑–∞–ø–æ–ª–Ω–µ–Ω:', weightInput.value);
              }
            }

            // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥–ª–∏–Ω—ã/–ø–ª–æ—â–∞–¥–∏ - –æ–±–Ω–æ–≤–ª—è–µ–º –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
            if (result.actual.length !== null) {
              const requestedLength = parseFloat(lengthInput.value);
              const calculatedLength = result.actual.length;
              const lengthChanged = Math.abs(calculatedLength - requestedLength) > 0.01;

              if (sourceField !== 'length' || lengthChanged) {
                lengthInput.value = result.actual.length.toFixed(2);
                if (lengthChanged && sourceField === 'length') {
                  console.log(`‚ö†Ô∏è –î–ª–∏–Ω–∞/–ø–ª–æ—â–∞–¥—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è: ${requestedLength.toFixed(2)} ‚Üí ${calculatedLength.toFixed(2)}`);
                }
                console.log('‚úÖ Length –∑–∞–ø–æ–ª–Ω–µ–Ω:', lengthInput.value);
              }
            }

            // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º —à—Ç—É–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏/–æ—Ü–∏–Ω–∫–æ–≤–∫–∏!
            // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–æ—Å—Ç —à—Ç—É–∫ –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –≤–≤–µ—Ä—Ö
            if (sourceField !== 'pieces' && result.actual.pieces !== null && !isRecalculatingFromMaterialChange) {
              piecesInput.value = result.actual.pieces;
              console.log('‚úÖ Pieces –∑–∞–ø–æ–ª–Ω–µ–Ω:', piecesInput.value);
            } else {
              if (isRecalculatingFromMaterialChange) {
                console.log('‚ö†Ô∏è Pieces –ù–ï –æ–±–Ω–æ–≤–ª–µ–Ω—ã! –ò–∑–º–µ–Ω–µ–Ω–∏–µ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏/–æ—Ü–∏–Ω–∫–æ–≤–∫–∏ - —à—Ç—É–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º–∏');
              } else {
                console.log('‚ùå Pieces –ù–ï –∑–∞–ø–æ–ª–Ω–µ–Ω! sourceField:', sourceField, 'pieces:', result.actual ? result.actual.pieces : 'undefined');
              }
            }
          } finally {
            // ‚ö†Ô∏è –°–ù–ò–ú–ê–ï–ú –§–õ–ê–ì: –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
            isUpdating = false;
          }

          // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          showResult(result);

          // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —à—Ç—É–∫–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ backend –∏—Ö –ù–ï —Ä–∞—Å—Å—á–∏—Ç–∞–ª
          // (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª —à–∏—Ä–∏–Ω—É/–¥–ª–∏–Ω—É –ø–æ—Å–ª–µ —Ä–∞—Å—á—ë—Ç–∞ —Ç–æ–Ω–Ω)
          if (sourceField !== 'pieces' && result.actual.pieces === null) {
            setTimeout(() => {
              recalculatePiecesOnly();
            }, 0);
          }

        } else {
          // –û—à–∏–±–∫–∞ —Ä–∞—Å—á—ë—Ç–∞
          showError(result.error);
        }

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞:', error);
        showError(error.message);
      } finally {
        isCalculating = false;
      }
    }

    /**
     * Debounce —Ñ—É–Ω–∫—Ü–∏—è (–∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º)
     */
    function debounceRecalculate(sourceField, delay = 500) {
      // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞ –∏–¥—ë—Ç –≤–≤–æ–¥
      hideResult();

      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        recalculateFields(sourceField);
      }, delay);
    }

    /**
     * –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞
     * (–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏, –°—Ç–∞–Ω–¥–∞—Ä—Ç, –†–∏—Ñ–ª–µ–Ω–∏–µ, –û—Ü–∏–Ω–∫–æ–≤–∫–∞)
     */
    function updateMaterialPropertiesFields(metalType, metal) {
      console.log('üé® updateMaterialPropertiesFields –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è:', metalType);

      // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –≤—Å–µ –ø–æ–ª—è
      const container = document.getElementById('material-properties-container');
      const fieldSteelType = document.getElementById('field-steel-type');
      const fieldStandard = document.getElementById('field-standard');
      const fieldRiffleType = document.getElementById('field-riffle-type');
      const fieldZincOption = document.getElementById('field-zinc-option');
      const fieldSteelTypeSquare = document.getElementById('field-steel-type-square');

      const steelTypeSelect = document.getElementById('steel-type-select');
      const standardSelect = document.getElementById('standard-select');
      const riffleTypeSelect = document.getElementById('riffle-type-select');
      const zincOptionSelect = document.getElementById('zinc-option-select');
      const steelTypeSquareSelect = document.getElementById('steel-type-square-select');

      // 1. –°–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      fieldSteelType.classList.add('hidden');
      fieldStandard.classList.add('hidden');
      fieldRiffleType.classList.add('hidden');
      fieldZincOption.classList.add('hidden');
      fieldSteelTypeSquare.classList.add('hidden');

      let hasAnyField = false;

      // 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ –ø–æ–ª—è –ø–æ–∫–∞–∑–∞—Ç—å –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞

      // === –ú–ê–†–ö–ê –°–¢–ê–õ–ò (–¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤) ===
      const typesWithSteel = ['circle', 'circle_galv', 'strip_tape', 'strip_tape_painted', 'strip_tape_galv',
                              'sheet_hot', 'sheet_painted', 'sheet_galv', 'sheet_cold', 'plate'];
      // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–æ–ª–µ–π
      const steelList = metal.steelGrades || metal.steelTypes;
      const steelCoefs = metal.steelDensities || metal.steelCoefficients;
      if (typesWithSteel.includes(metalType) && steelList && steelList.length > 0) {
        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç –º–∞—Ä–∫–∞–º–∏ —Å—Ç–∞–ª–∏
        steelTypeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É —Å—Ç–∞–ª–∏ --</option>';
        steelList.forEach(steel => {
          const option = document.createElement('option');
          option.value = steel;
          const density = steelCoefs && steelCoefs[steel]
            ? ` (${steelCoefs[steel]} –∫–≥/–¥–º¬≥)`
            : '';
          option.textContent = steel + density;
          steelTypeSelect.appendChild(option);
        });
        // –í—ã–±—Ä–∞—Ç—å —Å—Ç3 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
        if (steelList.includes('—Å—Ç3')) {
          steelTypeSelect.value = '—Å—Ç3';
        }
        fieldSteelType.classList.remove('hidden');
        hasAnyField = true;
        console.log(`  ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª–µ "–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏" (${steelList.length} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)`);
      }

      // === –°–¢–ê–ù–î–ê–†–¢ (–¢–£) (–¥–ª—è –õ–∏—Å—Ç–∞ –ü–í) ===
      if ((metalType === 'sheet_pv' || metalType === 'sheet_pv_galv') && metal.sizeStandards) {
        // –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–∑–º–µ—Ä–∞
        // –°–µ–π—á–∞—Å –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π
        standardSelect.innerHTML = '<option value="">-- –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–º–µ—Ä --</option>';
        fieldStandard.classList.remove('hidden');
        hasAnyField = true;
        console.log('  ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª–µ "–°—Ç–∞–Ω–¥–∞—Ä—Ç (–¢–£)" (–±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–∑–º–µ—Ä–∞)');
      }

      // === –†–ò–§–õ–ï–ù–ò–ï (–¥–ª—è –õ–∏—Å—Ç–∞ —Ä–∏—Ñ–ª–µ–Ω–æ–≥–æ) ===
      if (metalType === 'sheet_checkered' && metal.riffleTypes && metal.riffleTypes.length > 0) {
        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç —Ç–∏–ø–∞–º–∏ —Ä–∏—Ñ–ª–µ–Ω–∏—è
        riffleTypeSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∏—Ñ–ª–µ–Ω–∏—è --</option>';
        metal.riffleTypes.forEach(riffle => {
          const option = document.createElement('option');
          option.value = riffle;
          const coef = metal.riffleCoefficients && metal.riffleCoefficients[riffle]
            ? ` (–∫–æ—ç—Ñ. ${metal.riffleCoefficients[riffle]})`
            : '';
          option.textContent = riffle + coef;
          riffleTypeSelect.appendChild(option);
        });
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∏—Ñ–ª–µ–Ω–∏—è
        if (metal.riffleTypes.length > 0) {
          riffleTypeSelect.value = metal.riffleTypes[0];
          console.log(`  üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω–æ —Ä–∏—Ñ–ª–µ–Ω–∏–µ: ${metal.riffleTypes[0]}`);
        }
        fieldRiffleType.classList.remove('hidden');
        hasAnyField = true;
        console.log(`  ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª–µ "–†–∏—Ñ–ª–µ–Ω–∏–µ" (${metal.riffleTypes.length} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)`);
      }

      // === –û–¶–ò–ù–ö–û–í–ö–ê (–¥–ª—è —Ç–∏–ø–æ–≤ —Å –æ—Ü–∏–Ω–∫–æ–≤–∫–æ–π) ===
      const typesWithZinc = ['strip_tape_painted', 'strip_tape_galv', 'sheet_painted', 'sheet_galv', 'sheet_pv_galv'];
      // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–æ–ª–µ–π
      const galvList = metal.galvanization || metal.zincOptions;
      const galvCoefs = metal.galvanizationWeights || metal.zincCoefficients;
      if (typesWithZinc.includes(metalType) && galvList && galvList.length > 0) {
        // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
        zincOptionSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ü–∏–Ω–∫–æ–≤–∫–∏ --</option>';
        galvList.forEach(zinc => {
          const option = document.createElement('option');
          option.value = zinc;
          const coef = galvCoefs && galvCoefs[zinc]
            ? ` (${galvCoefs[zinc]} –∫–≥/–º¬≤)`
            : '';
          option.textContent = zinc + coef;
          zincOptionSelect.appendChild(option);
        });
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
        if (galvList.length > 0) {
          zincOptionSelect.value = galvList[0];
          console.log(`  üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω–∞ –æ—Ü–∏–Ω–∫–æ–≤–∫–∞: ${galvList[0]}`);
        }
        fieldZincOption.classList.remove('hidden');
        hasAnyField = true;
        console.log(`  ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª–µ "–û—Ü–∏–Ω–∫–æ–≤–∫–∞" (${galvList.length} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)`);
      }

      // === –ú–ê–†–ö–ê –°–¢–ê–õ–ò –î–õ–Ø –ö–í–ê–î–†–ê–¢–ê ===
      if (metalType === 'square') {
        // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–∞—Ä–æ–∫ —Å—Ç–∞–ª–∏ –∏ –∏—Ö –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        const steelList = metal.steelTypes || metal.steelGrades;
        const steelCoefs = metal.steelCoefficients || metal.steelDensities;

        if (steelList && steelList.length > 0) {
          // –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Å–µ–ª–µ–∫—Ç –≤—Å–µ–º–∏ 137 –º–∞—Ä–∫–∞–º–∏ —Å—Ç–∞–ª–∏
          steelTypeSquareSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É —Å—Ç–∞–ª–∏ --</option>';
          steelList.forEach(steel => {
            const option = document.createElement('option');
            option.value = steel;
            const density = steelCoefs && steelCoefs[steel]
              ? ` (${steelCoefs[steel]} —Ç/–º¬≥)`
              : '';
            option.textContent = steel + density;
            // –î–æ–±–∞–≤–∏—Ç—å data-–∞—Ç—Ä–∏–±—É—Ç —Å –ø–ª–æ—Ç–Ω–æ—Å—Ç—å—é –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            if (steelCoefs && steelCoefs[steel]) {
              option.setAttribute('data-density', steelCoefs[steel]);
            }
            steelTypeSquareSelect.appendChild(option);
          });

          // –í—ã–±—Ä–∞—Ç—å —Å—Ç3 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø–ª–æ—Ç–Ω–æ—Å—Ç—å 7.85)
          if (steelList.includes('—Å—Ç3')) {
            steelTypeSquareSelect.value = '—Å—Ç3';
            console.log('  üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω–∞ –º–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏: —Å—Ç3 (7.85 —Ç/–º¬≥)');
          }

          fieldSteelTypeSquare.classList.remove('hidden');
          hasAnyField = true;
          console.log(`  ‚úÖ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª–µ "–ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ –¥–ª—è –ö–≤–∞–¥—Ä–∞—Ç–∞" (${steelList.length} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)`);
        }
      }

      // 3. –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      if (hasAnyField) {
        container.classList.remove('hidden');
        console.log('  ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä material-properties-container –ø–æ–∫–∞–∑–∞–Ω');
      } else {
        container.classList.add('hidden');
        console.log('  ‚ö†Ô∏è  –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä material-properties-container —Å–∫—Ä—ã—Ç (–Ω–µ—Ç –ø–æ–ª–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)');
      }
    }

    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –¥–ª—è –ª–∏—Å—Ç–æ–≤—ã—Ö –º–µ—Ç–∞–ª–ª–æ–≤
     * –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø - —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å—é –≤—Å–µ—Ö –ø–æ–ª–µ–π
     */
    function updateSheetFieldsVisibility() {
      const metalType = document.getElementById('metal-type').value;

      console.log('üîß updateSheetFieldsVisibility –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è —Ç–∏–ø–∞:', metalType);

      // –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ª–µ–π (–ø–æ–ª–µ –ø–ª–æ—â–∞–¥–∏ —É–¥–∞–ª–µ–Ω–æ - –æ–Ω–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
      const fieldLength = document.getElementById('field-length');
      const fieldWidth = document.getElementById('field-width');
      const fieldLengthSheet = document.getElementById('field-length-sheet');
      const calculatedBox = document.getElementById('calculated-area-box');

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
      if (!fieldLength || !fieldWidth || !fieldLengthSheet) {
        console.error('‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ–ª–µ–π!');
        console.error('  field-length:', fieldLength ? '‚úÖ' : '‚ùå');
        console.error('  field-width:', fieldWidth ? '‚úÖ' : '‚ùå');
        console.error('  field-length-sheet:', fieldLengthSheet ? '‚úÖ' : '‚ùå');
        return;
      }

      // ===== –ö–†–ï–ü–ï–ñ–ò: –°–ö–†–´–¢–¨ "–î–õ–ò–ù–ê", –ü–û–ö–ê–ó–ê–¢–¨ "–ö–û–õ–ò–ß–ï–°–¢–í–û" =====
      if (FASTENER_TYPES.includes(metalType)) {
        console.log('üî© –¢–∏–ø –º–µ—Ç–∞–ª–ª–∞ - –∫—Ä–µ–ø—ë–∂. –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ "–î–ª–∏–Ω–∞ –º–µ—Ç—Ä—ã"');

        // –î–ª—è –∫—Ä–µ–ø–µ–∂–µ–π: —Å–∫—Ä—ã–≤–∞–µ–º –¥–ª–∏–Ω—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤–µ—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        fieldLength.style.display = 'none';
        lengthInput.value = '';  // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ

        // –°–∫—Ä—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–ª–∏—Å—Ç–æ–≤—ã–µ, –¥–ª–∏–Ω–∞ 1 —à—Ç.)
        fieldWidth.style.display = 'none';
        fieldLengthSheet.style.display = 'none';
        if (calculatedBox) calculatedBox.style.display = 'none';

        const fieldLengthPerPiece = document.getElementById('field-length-per-piece');
        if (fieldLengthPerPiece) {
          fieldLengthPerPiece.style.display = 'none';
          lengthPerPieceInput.value = '';
        }

        return;  // –í—ã—Ö–æ–¥–∏–º, –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
      }

      // ===== –ù–ï-–ö–†–ï–ü–ï–ñ–ò: –ü–û–ö–ê–ó–ê–¢–¨ "–î–õ–ò–ù–ê" =====
      console.log('üìê –¢–∏–ø –º–µ—Ç–∞–ª–ª–∞ - –Ω–µ –∫—Ä–µ–ø—ë–∂. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ "–î–ª–∏–Ω–∞ –º–µ—Ç—Ä—ã"');
      fieldLength.style.display = 'block';

      // ===== –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¢–ò–ü–´ –ú–ï–¢–ê–õ–õ–û–í =====

      // –õ–∏—Å—Ç—ã –∏ –ª–µ–Ω—Ç—ã (–Ω—É–∂–Ω—ã —à–∏—Ä–∏–Ω–∞ –∏ –¥–ª–∏–Ω–∞ –ª–∏—Å—Ç–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —à—Ç—É–∫)
      const needsSheetFields = (
        metalType === 'strip_tape' ||      // –õ–µ–Ω—Ç–∞/—à—Ç—Ä–∏–ø—Å
        metalType === 'strip_tape_painted' || // –õ–µ–Ω—Ç–∞/—à—Ç—Ä–∏–ø—Å –æ–∫—Ä–∞—à.
        metalType === 'strip_tape_galv' || // –õ–µ–Ω—Ç–∞/—à—Ç—Ä–∏–ø—Å –æ—Ü.
        metalType === 'sheet_hot' ||       // –õ–∏—Å—Ç/—Ä—É–ª–æ–Ω –≥/–∫
        metalType === 'sheet_cold' ||      // –õ–∏—Å—Ç/—Ä—É–ª–æ–Ω —Ö/–∫
        metalType === 'sheet_galv' ||      // –õ–∏—Å—Ç/—Ä—É–ª–æ–Ω –æ—Ü–∏–Ω–∫.
        metalType === 'sheet_painted' ||   // –õ–∏—Å—Ç/—Ä—É–ª–æ–Ω –æ–∫—Ä–∞—à.
        metalType === 'sheet_pv' ||        // –õ–∏—Å—Ç –ü–í
        metalType === 'sheet_pv_galv' ||   // –õ–∏—Å—Ç –ü–í –æ—Ü–∏–Ω–∫.
        metalType === 'sheet_checkered' || // –õ–∏—Å—Ç —Ä–∏—Ñ–ª–µ–Ω—ã–π
        metalType === 'plate'              // –ü–ª–∏—Ç–∞
      );

      // ===== –ü–û–ö–ê–ó–ê–¢–¨ –ò–õ–ò –°–ö–†–´–¢–¨ –ü–û–õ–Ø =====

      if (needsSheetFields) {
        console.log('‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—è —à–∏—Ä–∏–Ω—ã –∏ –¥–ª–∏–Ω—ã –¥–ª—è', metalType);

        // –ü–æ–∫–∞–∑–∞—Ç—å —à–∏—Ä–∏–Ω—É –∏ –¥–ª–∏–Ω—É –ª–∏—Å—Ç–∞
        fieldWidth.style.display = 'block';
        fieldLengthSheet.style.display = 'block';

        // –û—á–∏—Å—Ç–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞
        widthInput.value = '';
        lengthSheetInput.value = '';

        // –°–∫—Ä—ã—Ç—å –±–ª–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–æ—â–∞–¥—å—é
        if (calculatedBox) calculatedBox.style.display = 'none';

      } else {
        console.log('‚ùå –°–∫—Ä—ã–≤–∞–µ–º –ª–∏—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –¥–ª—è', metalType);

        // –°–∫—Ä—ã—Ç—å —à–∏—Ä–∏–Ω—É –∏ –¥–ª–∏–Ω—É
        fieldWidth.style.display = 'none';
        fieldLengthSheet.style.display = 'none';

        // –°–∫—Ä—ã—Ç—å –±–ª–æ–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–æ—â–∞–¥—å—é
        if (calculatedBox) calculatedBox.style.display = 'none';
      }

      // ===== –ü–û–ö–ê–ó–ê–¢–¨/–°–ö–†–´–¢–¨ –ü–û–õ–ï "–î–õ–ò–ù–ê 1 –®–¢." =====
      const fieldLengthPerPiece = document.getElementById('field-length-per-piece');
      if (fieldLengthPerPiece) {
        if (TYPES_WITH_LENGTH_FIELD.includes(metalType)) {
          console.log('‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ "–î–ª–∏–Ω–∞ 1 —à—Ç." –¥–ª—è', metalType);
          fieldLengthPerPiece.style.display = 'block';
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 12 –º, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
          if (!lengthPerPieceInput.value || lengthPerPieceInput.value === '0') {
            lengthPerPieceInput.value = '12';
          }
        } else {
          console.log('‚ùå –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ "–î–ª–∏–Ω–∞ 1 —à—Ç." –¥–ª—è', metalType);
          fieldLengthPerPiece.style.display = 'none';
          lengthPerPieceInput.value = '';  // –û—á–∏—â–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        }
      }
    }

    // ============================================================================
    // –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–û–†–ò–¢–ï–¢–û–ú
    // ============================================================================

    /**
     * üîÑ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—è
     * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê–ö–¢–ò–í–ù–û –≤–≤–æ–¥–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ
     * (–Ω–æ –ù–ï –ø—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!)
     */
    function changePriority(newPriority) {
      // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - –Ω–µ –º–µ–Ω—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
      if (isUpdating) {
        return;
      }

      // –ï—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è - –ª–æ–≥–∏—Ä—É–µ–º
      if (inputPriority !== newPriority) {
        console.log(`üîÑ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏–∑–º–µ–Ω—ë–Ω: ${inputPriority || 'null'} ‚Üí ${newPriority}`);
        inputPriority = newPriority;
      } else if (!inputPriority) {
        // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤–ø–µ—Ä–≤—ã–µ
        console.log(`üîí –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—è: ${newPriority}`);
        inputPriority = newPriority;
      }
    }

    /**
     * –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π –∏–ª–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ –º–µ—Ç–∞–ª–ª–∞)
     */
    function resetPriority() {
      const weight = parseFloat(weightInput.value) || 0;
      const length = parseFloat(lengthInput.value) || 0;
      const pieces = parseInt(piecesInput.value) || 0;

      // –ï—Å–ª–∏ –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
      if (weight === 0 && length === 0 && pieces === 0) {
        if (inputPriority) {
          console.log(`üîì –°–±—Ä–æ—à–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—è: ${inputPriority}`);
        }
        inputPriority = null;
      }
    }

    // ============================================================================
    // –°–û–ë–´–¢–ò–Ø –ù–ê –ü–û–õ–Ø–•
    // ============================================================================

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Å–∞
    weightInput.addEventListener('input', (e) => {
      const value = parseFloat(e.target.value) || 0;

      if (value > 0) {
        // üîÑ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –º–µ–Ω—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ –í–ï–°–¢ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –≤–≤–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        changePriority('weight');
      }

      debounceRecalculate('weight');
      resetPriority();
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã
    lengthInput.addEventListener('input', (e) => {
      const value = parseFloat(e.target.value) || 0;

      if (value > 0) {
        changePriority('length');
      }

      debounceRecalculate('length');
      resetPriority();
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    piecesInput.addEventListener('input', (e) => {
      const value = parseInt(e.target.value) || 0;

      if (value > 0) {
        // üîÑ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò –º–µ–Ω—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ –ö–û–õ–ò–ß–ï–°–¢–í–û –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –≤–≤–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        changePriority('pieces');
      }

      // –ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã "–î–ª–∏–Ω–∞ 1 —à—Ç." –∏ "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" ‚Üí —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—â—É—é –¥–ª–∏–Ω—É
      // calculateTotalLengthFromPieces() –≤—ã–∑–æ–≤–µ—Ç debounceRecalculate() —Å —É—á—ë—Ç–æ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
      const calculated = calculateTotalLengthFromPieces();

      // –ï—Å–ª–∏ –ø–æ–ª–µ "–î–ª–∏–Ω–∞ 1 —à—Ç." –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç
      if (!calculated) {
        debounceRecalculate('pieces');
      }

      resetPriority();
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã 1 —à—Ç. ‚Üí —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–±—â—É—é –¥–ª–∏–Ω—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    // ‚ö†Ô∏è –ù–ï –º–µ–Ω—è–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã 1 —à—Ç!
    lengthPerPieceInput.addEventListener('input', (e) => {
      calculateTotalLengthFromPieces();
    });

    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –æ–±—â–µ–π –¥–ª–∏–Ω—ã –∏–∑ "–î–ª–∏–Ω–∞ 1 —à—Ç." √ó "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ"
    // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ –≤—ã–∑–≤–∞–ª–∞ –ø–µ—Ä–µ—Å—á—ë—Ç, false –µ—Å–ª–∏ –Ω–µ—Ç
    function calculateTotalLengthFromPieces() {
      const lengthPerPiece = parseFloat(lengthPerPieceInput.value);
      const pieces = parseInt(piecesInput.value);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–æ–ª–µ "–î–ª–∏–Ω–∞ 1 —à—Ç." –≤–∏–¥–∏–º–æ (–¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –º–µ—Ç–∞–ª–ª–∞)
      const fieldLengthPerPiece = document.getElementById('field-length-per-piece');
      const isVisible = fieldLengthPerPiece && fieldLengthPerPiece.style.display !== 'none';

      if (isVisible && lengthPerPiece && pieces && lengthPerPiece > 0 && pieces > 0) {
        const totalLength = lengthPerPiece * pieces;
        lengthInput.value = totalLength.toFixed(2);
        console.log(`üìê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç: ${pieces} —à—Ç √ó ${lengthPerPiece} –º = ${totalLength} –º`);

        // ‚úÖ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –£—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—è
        // –ï—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É weight ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º pieces (weight –æ—Å—Ç–∞—ë—Ç—Å—è)
        // –ï—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É pieces ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º weight (pieces –æ—Å—Ç–∞—ë—Ç—Å—è)
        if (inputPriority === 'weight') {
          console.log(`üîí –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –í–ï–°–ê ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫`);
          debounceRecalculate('weight');
        } else {
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É pieces –∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
          console.log(`üîí –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É –ö–û–õ–ò–ß–ï–°–¢–í–ê (–∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω) ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –≤–µ—Å`);
          piecesInput.value = pieces;
          debounceRecalculate('pieces');
        }

        return true;  // –£—Å–ø–µ—à–Ω–æ –≤—ã–∑–≤–∞–Ω –ø–µ—Ä–µ—Å—á—ë—Ç
      }

      return false;  // –ü–æ–ª–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
    }

    // –ü–æ–ª–µ "–ü–ª–æ—â–∞–¥—å" —É–¥–∞–ª–µ–Ω–æ - –ø–ª–æ—â–∞–¥—å —Å—á–∏—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ —à–∏—Ä–∏–Ω—ã √ó –¥–ª–∏–Ω—ã

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —à–∏—Ä–∏–Ω—ã –û–î–ù–û–ì–û –ª–∏—Å—Ç–∞ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å —É—á—ë—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
    widthInput.addEventListener('input', (e) => {
      showSheetArea();  // –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–æ—â–∞–¥—å 1 –ª–∏—Å—Ç–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

      // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–µ—Å, –¥–ª–∏–Ω–∞ –∏–ª–∏ —à—Ç—É–∫–∏ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –ª–∏—Å—Ç–∞
      // Backend –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –∏ –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–Ω–Ω—ã
      if (weightInput.value) {
        debounceRecalculate('weight');  // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –° –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º —à—Ç—É–∫ –∏ —Ç–æ–Ω–Ω
      } else if (lengthInput.value) {
        debounceRecalculate('length');
      } else if (piecesInput.value) {
        debounceRecalculate('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–ª–∏–Ω—ã –û–î–ù–û–ì–û –ª–∏—Å—Ç–∞ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å —É—á—ë—Ç–æ–º –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
    lengthSheetInput.addEventListener('input', (e) => {
      showSheetArea();  // –ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–æ—â–∞–¥—å 1 –ª–∏—Å—Ç–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

      // –ï—Å–ª–∏ –µ—Å—Ç—å –≤–µ—Å, –¥–ª–∏–Ω–∞ –∏–ª–∏ —à—Ç—É–∫–∏ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –ª–∏—Å—Ç–∞
      // Backend –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –∏ –æ–±–Ω–æ–≤–∏—Ç —Ç–æ–Ω–Ω—ã
      if (weightInput.value) {
        debounceRecalculate('weight');  // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –° –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º —à—Ç—É–∫ –∏ —Ç–æ–Ω–Ω
      } else if (lengthInput.value) {
        debounceRecalculate('length');
      } else if (piecesInput.value) {
        debounceRecalculate('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–µ—Ç–∞–ª–ª–∞ –∏–ª–∏ —Ä–∞–∑–º–µ—Ä–∞ - –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª—è
    document.getElementById('metal-type').addEventListener('change', () => {
      weightInput.value = '';
      lengthInput.value = '';
      piecesInput.value = '';
      // areaInput —É–¥–∞–ª—ë–Ω
      widthInput.value = '';
      lengthSheetInput.value = '';
      document.getElementById('calculated-area-box').style.display = 'none';
      hideResult();

      // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–æ–ª—è –¥–ª—è –ª–∏—Å—Ç–æ–≤
      updateSheetFieldsVisibility();
    });

    document.getElementById('size').addEventListener('change', () => {
      weightInput.value = '';
      lengthInput.value = '';
      piecesInput.value = '';
      // areaInput —É–¥–∞–ª—ë–Ω
      widthInput.value = '';
      lengthSheetInput.value = '';
      document.getElementById('calculated-area-box').style.display = 'none';

      // üîì –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–º–µ—Ä–∞
      if (inputPriority) {
        console.log(`üîì –°–±—Ä–æ—à–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–º–µ—Ä–∞: ${inputPriority}`);
        inputPriority = null;
      }

      // === –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –°–¢–ê–ù–î–ê–†–¢–û–í –î–õ–Ø –õ–ò–°–¢–ê –ü–í ===
      const metalType = document.getElementById('metal-type').value;
      const sizeValue = document.getElementById('size').value;

      if ((metalType === 'sheet_pv' || metalType === 'sheet_pv_galv') && sizeValue && metalDatabase) {
        const metal = metalDatabase.metals[metalType];
        if (metal && metal.sizeStandards && metal.sizeStandards[sizeValue]) {
          const standardSelect = document.getElementById('standard-select');
          standardSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç --</option>';

          metal.sizeStandards[sizeValue].forEach(standard => {
            const option = document.createElement('option');
            option.value = standard.name;
            option.textContent = standard.name;
            standardSelect.appendChild(option);
          });

          // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞—Ç—å –ø–µ—Ä–≤—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç
          if (metal.sizeStandards[sizeValue].length > 0) {
            const firstStandard = metal.sizeStandards[sizeValue][0].name;
            standardSelect.value = firstStandard;
            console.log(`üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç: ${firstStandard}`);
          }

          console.log(`üìê –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${metal.sizeStandards[sizeValue].length} —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞ ${sizeValue}`);
        }
      }

      hideResult();
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏ (–∫–∞—Ç–∞–Ω–∫–∞) - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('steel-type')?.addEventListener('change', () => {
      // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ç —Ç–æ–≥–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏ –¥–ª—è –ö–≤–∞–¥—Ä–∞—Ç–∞ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('steel-type-square-select')?.addEventListener('change', () => {
      console.log('üîÑ –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ –¥–ª—è –ö–≤–∞–¥—Ä–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç');
      // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ç —Ç–æ–≥–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∏—Ñ–ª–µ–Ω–∏—è –¥–ª—è –õ–∏—Å—Ç–∞ —Ä–∏—Ñ–ª–µ–Ω–æ–≥–æ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('riffle-type-select')?.addEventListener('change', () => {
      console.log('üîÑ –¢–∏–ø —Ä–∏—Ñ–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω—ë–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç');
      // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ç —Ç–æ–≥–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('zinc-option-select')?.addEventListener('change', () => {
      console.log('üîÑ –í–∞—Ä–∏–∞–Ω—Ç –æ—Ü–∏–Ω–∫–æ–≤–∫–∏ –∏–∑–º–µ–Ω—ë–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç');
      // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ç —Ç–æ–≥–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ –¥–ª—è –õ–∏—Å—Ç–∞ –ü–í - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('standard-select')?.addEventListener('change', () => {
      console.log('üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç (–¢–£) –∏–∑–º–µ–Ω—ë–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç');
      // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ç —Ç–æ–≥–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –º–µ—Ç–∞–ª–ª–æ–≤ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('steel-type-select')?.addEventListener('change', () => {
      console.log('üîÑ –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ—Å—á—ë—Ç');
      // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –æ—Ç —Ç–æ–≥–æ –ø–æ–ª—è –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Ü–∏–Ω–∫–æ–≤–∫–∏ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    document.getElementById('galvanized').addEventListener('change', () => {
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    document.getElementById('galv-coef')?.addEventListener('change', () => {
      if (weightInput.value) {
        recalculateFields('weight');
      } else if (lengthInput.value) {
        recalculateFields('length');
      } else if (piecesInput.value) {
        recalculateFields('pieces');
      }
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ (–õ–∏—Å—Ç –ü–í) - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    const standardSelect = document.getElementById('standard-select');
    if (standardSelect) {
      standardSelect.addEventListener('change', () => {
        console.log('üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç –∏–∑–º–µ–Ω—ë–Ω, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é...');
        if (weightInput.value) {
          recalculateFields('weight');
        } else if (lengthInput.value) {
          recalculateFields('length');
        } else if (piecesInput.value) {
          recalculateFields('pieces');
        } else if (areaInput.value) {
          recalculateFields('area');
        }
      });
    }

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏ - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¢–û–õ–¨–ö–û –í–ï–° (–ù–ï —à—Ç—É–∫–∏!)
    const steelTypeSelect = document.getElementById('steel-type-select');
    if (steelTypeSelect) {
      steelTypeSelect.addEventListener('change', () => {
        console.log('üîÑ –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∞, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é –¢–û–õ–¨–ö–û –≤–µ—Å (—à—Ç—É–∫–∏ –ù–ï —Ç—Ä–æ–≥–∞–µ–º)...');

        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ–±—ã –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —à—Ç—É–∫–∏!
        isRecalculatingFromMaterialChange = true;

        try {
          if (weightInput.value) {
            recalculateFields('weight');
          } else if (lengthInput.value) {
            recalculateFields('length');
          } else if (piecesInput.value) {
            recalculateFields('pieces');
          }
        } finally {
          // ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å—á—ë—Ç–∞
          isRecalculatingFromMaterialChange = false;
        }
      });
    }

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–∏–ø–∞ —Ä–∏—Ñ–ª–µ–Ω–∏—è (–õ–∏—Å—Ç —Ä–∏—Ñ–ª–µ–Ω—ã–π) - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å
    const riffleTypeSelect = document.getElementById('riffle-type-select');
    if (riffleTypeSelect) {
      riffleTypeSelect.addEventListener('change', () => {
        console.log('üîÑ –¢–∏–ø —Ä–∏—Ñ–ª–µ–Ω–∏—è –∏–∑–º–µ–Ω—ë–Ω, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é...');
        if (weightInput.value) {
          recalculateFields('weight');
        } else if (lengthInput.value) {
          recalculateFields('length');
        } else if (piecesInput.value) {
          recalculateFields('pieces');
        } else if (areaInput.value) {
          recalculateFields('area');
        }
      });
    }

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ–ø—Ü–∏–∏ —Ü–∏–Ω–∫–æ–≤–∞–Ω–∏—è - –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¢–û–õ–¨–ö–û –í–ï–° (–ù–ï —à—Ç—É–∫–∏!)
    const zincOptionSelect = document.getElementById('zinc-option-select');
    if (zincOptionSelect) {
      zincOptionSelect.addEventListener('change', () => {
        console.log('üîÑ –û–ø—Ü–∏—è —Ü–∏–Ω–∫–æ–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∞, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é –¢–û–õ–¨–ö–û –≤–µ—Å (—à—Ç—É–∫–∏ –ù–ï —Ç—Ä–æ–≥–∞–µ–º)...');

        // ‚ö†Ô∏è –í–ê–ñ–ù–û: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ–±—ã –ù–ï –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å —à—Ç—É–∫–∏!
        isRecalculatingFromMaterialChange = true;

        try {
          if (weightInput.value) {
            recalculateFields('weight');
          } else if (lengthInput.value) {
            recalculateFields('length');
          } else if (piecesInput.value) {
            recalculateFields('pieces');
          }
          // areaInput —É–¥–∞–ª—ë–Ω
        } finally {
          // ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å—á—ë—Ç–∞
          isRecalculatingFromMaterialChange = false;
        }
      });
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function hideResult() {
      const resultDiv = document.getElementById('result-container');
      if (resultDiv) {
        resultDiv.classList.add('hidden');
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–∫–∏
    function showError(message) {
      const resultContainer = document.getElementById('result-container');
      const resultCard = document.getElementById('result-card');
      const resultTitle = document.getElementById('result-title');
      const resultContent = document.getElementById('result-content');

      resultCard.className = 'p-6 rounded-lg border-4 border-red-500 bg-red-50';
      resultTitle.textContent = '‚ùå –û—à–∏–±–∫–∞';
      resultTitle.className = 'text-2xl font-bold mb-4 text-red-700';
      resultContent.innerHTML = `
        <div class="error-box">
          ${message}
        </div>
      `;

      resultContainer.classList.remove('hidden');
    }

    // ============================================================================
    // –ö–û–ù–ï–¶ –õ–û–ì–ò–ö–ò –í–ó–ê–ò–ú–û–ó–ê–í–ò–°–ò–ú–´–• –ü–û–õ–ï–ô
    // ============================================================================

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã (—Ç–µ–ø–µ—Ä—å –ø–æ—á—Ç–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç.–∫. –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–æ–º)
    // –û—Å—Ç–∞–≤–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å
    document.getElementById('calculator-form').addEventListener('submit', (e) => {
      // –ë–ª–æ–∫–∏—Ä—É–µ–º submit - —Ç–µ–ø–µ—Ä—å –≤—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ –≤–∑–∞–∏–º–æ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è
      e.preventDefault();
      console.log('‚ö†Ô∏è Submit –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∑–∞–∏–º–æ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–ª—è (–≤–µ—Å/–¥–ª–∏–Ω–∞/–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)');
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    function showResult(result) {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
      lastResult = result;

      const container = document.getElementById('result-container');
      const card = document.getElementById('result-card');
      const title = document.getElementById('result-title');
      const content = document.getElementById('result-content');

      // –£—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –∑–µ–ª–µ–Ω–∞—è —Ä–∞–º–∫–∞
      card.className = 'p-6 rounded-lg border-4 border-green-500 bg-green-50';
      title.textContent = '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á–µ—Ç–∞';
      title.className = 'text-2xl font-bold mb-4 text-green-700';

      // ‚úÖ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê: –ï—Å–ª–∏ –µ—Å—Ç—å requested/actual - –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      if (result.requested && result.actual) {
        content.innerHTML = createEnhancedResult(result);
      } else {
        // Fallback –Ω–∞ —Å—Ç–∞—Ä–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
        content.innerHTML = createLegacyResult(result);
      }

      container.classList.remove('hidden');

      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –û–¢–ö–õ–Æ–ß–ï–ù–ê (UX: –Ω–µ –º–µ—à–∞–µ–º –≤–≤–æ–¥—É)
      // setTimeout(() => {
      //   container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      // }, 100);
    }

    // ‚úÖ –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å requested/actual/difference
    function createEnhancedResult(result) {
      let html = '';

      // === –°–ï–ö–¶–ò–Ø 1: –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø ===
      html += '<div class="mb-6 p-4 bg-white rounded-lg border-2 border-gray-200">';
      html += '<h4 class="text-sm font-bold text-gray-600 uppercase tracking-wide mb-3">üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Ç–∞–ª–ª–µ</h4>';

      html += createResultRow('üì¶ –ú–µ—Ç–∞–ª–ª', result.metalType);

      const formattedSize = Array.isArray(result.size)
        ? result.size.join('√ó') + ' –º–º'
        : (typeof result.size === 'number' ? result.size + ' –º–º' : result.size);
      html += createResultRow('üìè –†–∞–∑–º–µ—Ä', formattedSize);

      if (result.steelType) {
        html += createResultRow('üî© –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏', result.steelType);
      }

      html += createResultRow('üìã –ì–û–°–¢', result.gost);
      html += createResultRow('‚öñÔ∏è –í–µ—Å 1 –º–µ—Ç—Ä–∞', result.weightPerMeter.toFixed(3) + ' –∫–≥');

      if (result.standardLength) {
        html += createResultRow('üìê –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –¥–ª–∏–Ω–∞', result.standardLength + ' –º');
      }

      if (result.isGalvanized) {
        html += createResultRow('‚ú® –û—Ü–∏–Ω–∫–æ–≤–∫–∞', '–î–∞');
      }

      html += '</div>';

      // === –°–ï–ö–¶–ò–Ø 2: –ó–ê–ü–†–û–®–ï–ù–û ===
      html += '<div class="mb-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">';
      html += '<h4 class="text-sm font-bold text-blue-700 uppercase tracking-wide mb-2">üìù –ó–∞–ø—Ä–æ—à–µ–Ω–æ:</h4>';
      html += `<p class="text-2xl font-bold text-blue-900">${result.requested.label}</p>`;
      html += '</div>';

      // === –°–ï–ö–¶–ò–Ø 3: –§–ê–ö–¢–ò–ß–ï–°–ö–ò (–ö–†–ê–¢–ù–û –®–¢–£–ö–ê–ú) ===
      html += '<div class="mb-6 p-5 bg-green-50 rounded-lg border-3 border-green-400 shadow-sm">';
      html += '<h4 class="text-sm font-bold text-green-700 uppercase tracking-wide mb-4">‚úÖ –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ (–∫—Ä–∞—Ç–Ω–æ —à—Ç—É–∫–∞–º):</h4>';

      // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à—Ç—É–∫
      if (result.actual.pieces !== null) {
        let piecesText = `<strong>${result.actual.pieces} —à—Ç</strong>`;

        // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—è "–î–ª–∏–Ω–∞ 1 —à—Ç." –µ—Å–ª–∏ –æ–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ
        const lengthPerPieceInput = document.getElementById('input-length-per-piece');
        const fieldLengthPerPiece = document.getElementById('field-length-per-piece');
        const isFieldVisible = fieldLengthPerPiece && fieldLengthPerPiece.style.display !== 'none';
        const lengthPerPiece = lengthPerPieceInput && lengthPerPieceInput.value
          ? parseFloat(lengthPerPieceInput.value)
          : null;

        if (isFieldVisible && lengthPerPiece && lengthPerPiece > 0) {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–≤–µ–¥—ë–Ω–Ω–æ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
          piecesText += ` √ó ${lengthPerPiece}–º`;
        } else if (result.standardLength) {
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã
          piecesText += ` √ó ${result.standardLength}–º`;
        }

        html += createHighlightRow('üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', piecesText);
      }

      // –î–ª–∏–Ω–∞ —Å —Ä–∞–∑–Ω–∏—Ü–µ–π
      if (result.actual.length !== null) {
        let lengthText = `<strong>${result.actual.length} –º</strong>`;
        if (result.difference && result.difference.length) {
          lengthText += ` <span class="inline-block ml-2 px-3 py-1 bg-green-600 text-white text-sm font-bold rounded-full">${result.difference.length}</span>`;
        }
        html += createHighlightRow('üìê –î–ª–∏–Ω–∞', lengthText);
      }

      // –í–µ—Å —Å —Ä–∞–∑–Ω–∏—Ü–µ–π
      if (result.actual.weight !== null) {
        const weightKg = (result.actual.weight * 1000).toFixed(1);
        let weightText = `<strong>${result.actual.weight} —Ç</strong> (${weightKg} –∫–≥)`;
        if (result.difference && result.difference.weight) {
          weightText += ` <span class="inline-block ml-2 px-3 py-1 bg-green-600 text-white text-sm font-bold rounded-full">${result.difference.weight}</span>`;
        }
        html += createHighlightRow('üí∞ –í–µ—Å', weightText);
      }

      html += '</div>';

      return html;
    }

    // –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –¥–ª—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    function createHighlightRow(label, value) {
      return `
        <div class="flex justify-between items-center p-3 mb-2 bg-white rounded-lg border border-green-200">
          <span class="text-gray-700 font-semibold">${label}</span>
          <span class="text-green-900 text-lg">${value}</span>
        </div>
      `;
    }

    // ‚ö†Ô∏è –°–¢–ê–†–ê–Ø –§–£–ù–ö–¶–ò–Ø: –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    function createLegacyResult(result) {
      let html = '';

      html += createResultRow('üì¶ –ú–µ—Ç–∞–ª–ª', result.metalType);

      const formattedSize = Array.isArray(result.size)
        ? result.size.join('√ó') + ' –º–º'
        : (typeof result.size === 'number' ? result.size + ' –º–º' : result.size);

      html += createResultRow('üìè –†–∞–∑–º–µ—Ä', formattedSize);

      if (result.steelType) {
        html += createResultRow('üî© –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏', result.steelType);
      }

      html += createResultRow('üìã –ì–û–°–¢', result.gost);
      html += createResultRow('‚öñÔ∏è –í–µ—Å 1 –º–µ—Ç—Ä–∞', result.weightPerMeter.toFixed(3) + ' –∫–≥');

      if (result.weight !== undefined) {
        html += createResultRow('üí∞ –û–±—â–∏–π –≤–µ—Å', (result.weight * 1000).toFixed(2) + ' –∫–≥', true);
      }

      if (result.length !== undefined) {
        html += createResultRow('üìê –î–ª–∏–Ω–∞', result.length.toFixed(2) + ' –º', true);
      }

      if (result.pieces !== undefined) {
        html += createResultRow('üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', result.pieces + ' —à—Ç', true);
      }

      if (result.isGalvanized) {
        html += createResultRow('‚ú® –û—Ü–∏–Ω–∫–æ–≤–∫–∞', '–î–∞', true);
      }

      return html;
    }

    // –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–æ–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    function createResultRow(label, value, highlight = false) {
      const bgClass = highlight ? 'bg-green-100' : 'bg-white';
      const textClass = highlight ? 'text-green-900 font-bold text-lg' : 'text-gray-700';

      return `
        <div class="flex justify-between items-center p-3 ${bgClass} rounded-lg">
          <span class="text-gray-600 font-medium">${label}</span>
          <span class="${textClass}">${value}</span>
        </div>
      `;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    function showError(message) {
      const container = document.getElementById('result-container');
      const card = document.getElementById('result-card');
      const title = document.getElementById('result-title');
      const content = document.getElementById('result-content');

      // –û—à–∏–±–∫–∞ - –∫—Ä–∞—Å–Ω–∞—è —Ä–∞–º–∫–∞
      card.className = 'p-6 rounded-lg border-4 border-red-500 bg-red-50';
      title.textContent = '‚ùå –û—à–∏–±–∫–∞';
      title.className = 'text-2xl font-bold mb-4 text-red-700';
      content.innerHTML = `
        <div class="text-red-700">
          <p class="text-lg">${message}</p>
        </div>
      `;

      container.classList.remove('hidden');

      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –æ—à–∏–±–∫–µ –û–¢–ö–õ–Æ–ß–ï–ù–ê (UX: –Ω–µ –º–µ—à–∞–µ–º –≤–≤–æ–¥—É)
      // setTimeout(() => {
      //   container.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      // }, 100);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    function showLoading(show) {
      isLoading = show;
      const loading = document.getElementById('loading');
      const resultContainer = document.getElementById('result-container');

      if (show) {
        loading.classList.remove('hidden');
        resultContainer.classList.add('hidden');
      } else {
        loading.classList.add('hidden');
      }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyResultToClipboard() {
      if (!lastResult) {
        alert('‚ö†Ô∏è –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
        return;
      }

      // ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ç—Ä—É–±
      const formattedSize = Array.isArray(lastResult.size)
        ? lastResult.size.join('√ó') + ' –º–º'
        : (typeof lastResult.size === 'number' ? lastResult.size + ' –º–º' : lastResult.size);

      const text = `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  –†–ï–ó–£–õ–¨–¢–ê–¢ –†–ê–°–ß–Å–¢–ê - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–µ—Ç–∞–ª–ª–∞
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üì¶ –ú–µ—Ç–∞–ª–ª: ${lastResult.metalType}
üìè –†–∞–∑–º–µ—Ä: ${formattedSize}
${lastResult.steelType ? `üî© –ú–∞—Ä–∫–∞ —Å—Ç–∞–ª–∏: ${lastResult.steelType}\n` : ''}üìã –ì–û–°–¢: ${lastResult.gost}
üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${lastResult.category}

‚öñÔ∏è  –í–µ—Å 1 –º–µ—Ç—Ä–∞: ${lastResult.weightPerMeter.toFixed(3)} –∫–≥
${lastResult.weight !== undefined ? `üí∞ –û–±—â–∏–π –≤–µ—Å: ${(lastResult.weight * 1000).toFixed(2)} –∫–≥ (${lastResult.weight.toFixed(3)} —Ç)\n` : ''}${lastResult.length !== undefined ? `üìê –î–ª–∏–Ω–∞: ${lastResult.length.toFixed(2)} –º\n` : ''}${lastResult.pieces !== undefined ? `üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${lastResult.pieces} —à—Ç\n` : ''}${lastResult.isGalvanized ? `‚ú® –û—Ü–∏–Ω–∫–æ–≤–∫–∞: –î–∞\n` : ''}
üìÖ –î–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞: ${new Date().toLocaleString('ru-RU')}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Powered by Metal Calculator API
      `.trim();

      navigator.clipboard.writeText(text).then(() => {
        alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      }).catch(err => {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
        alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
      });
    }

    // –°–±—Ä–æ—Å–∏—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
    function resetCalculator() {
      // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      document.getElementById('result-container').classList.add('hidden');

      // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
      document.getElementById('calculator-form').reset();

      // –°–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏
      document.getElementById('metal-info').classList.add('hidden');
      document.getElementById('available-sizes').classList.add('hidden');
      document.getElementById('katanka-fields').classList.add('hidden');
      document.getElementById('galv-coef-container').classList.add('hidden');

      // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      lastResult = null;

      // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ –Ω–∞—á–∞–ª—É —Ñ–æ—Ä–º—ã
      document.getElementById('calculator-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // ‚úÖ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –†–ê–°–ß–Å–¢ (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ UX 2/2)

    // Debounce —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —á–∞—Å—Ç—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
    async function tryAutoCalculate() {
      // –ü—Ä–æ–≤–µ—Ä–∫–∏
      if (isLoading || !metalDatabase) return;

      const metalType = document.getElementById('metal-type').value;
      const size = document.getElementById('size').value;
      const value = document.getElementById('value').value;

      // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
      if (!metalType || !size || !value || value <= 0) return;

      // –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º submit —Ñ–æ—Ä–º—ã
      const form = document.getElementById('calculator-form');
      const submitEvent = new Event('submit', { cancelable: true, bubbles: true });
      form.dispatchEvent(submitEvent);
    }

    // –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π
    function setupAutoCalculate() {
      // Event listeners –¥–ª—è –ø–æ–ª–µ–π
      const fields = [
        { id: 'metal-type', event: 'change' },
        { id: 'size', event: 'change' },
        { id: 'steel-type', event: 'change' },
        { id: 'piece-length', event: 'input', debounced: true }
      ];

      fields.forEach(({ id, event, debounced }) => {
        const element = document.getElementById(id);
        if (element) {
          if (debounced) {
            element.addEventListener(event, debounce(tryAutoCalculate, 800));
          } else {
            element.addEventListener(event, tryAutoCalculate);
          }
        }
      });

      // Checkbox –æ—Ü–∏–Ω–∫–æ–≤–∫–∏
      document.getElementById('galvanized')?.addEventListener('change', tryAutoCalculate);
      document.getElementById('galv-coef')?.addEventListener('change', tryAutoCalculate);

      console.log('‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –≤–∫–ª—é—á—ë–Ω');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadDatabase().then(() => {
      // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ë–î –≤–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç
      setupAutoCalculate();

      // ===== –û–¢–õ–ê–î–ö–ê: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ =====
      console.log('üì± –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω');
      console.log('üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ª–∏—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π:');
      console.log('  - field-area:', document.getElementById('field-area') ? '‚úÖ' : '‚ùå');
      console.log('  - field-width:', document.getElementById('field-width') ? '‚úÖ' : '‚ùå');
      console.log('  - field-length-sheet:', document.getElementById('field-length-sheet') ? '‚úÖ' : '‚ùå');
      console.log('  - input-area:', document.getElementById('input-area') ? '‚úÖ' : '‚ùå');
      console.log('  - input-width:', document.getElementById('input-width') ? '‚úÖ' : '‚ùå');
      console.log('  - input-length-sheet:', document.getElementById('input-length-sheet') ? '‚úÖ' : '‚ùå');

      // ===== –í–´–ó–í–ê–¢–¨ updateSheetFieldsVisibility –ï–°–õ–ò –£–ñ–ï –í–´–ë–†–ê–ù –¢–ò–ü =====
      const metalTypeSelect = document.getElementById('metal-type');
      if (metalTypeSelect && metalTypeSelect.value) {
        console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–π –¥–ª—è —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞:', metalTypeSelect.value);
        updateSheetFieldsVisibility();
      }
    });
  </script>
</body>
</html>
